<div fxLayout="column" fxLayoutGap="25px">
    <div fxLayout="row wrap" class="d-cards">
        <div fxFlex="100" fxFlex.md="100" fxFlex.sm="100" fxFlex.xs="100" fxLayout="column">
            <mat-card class="shadow p-t-15">
                <mat-tab-group (selectedTabChange)="selectedTabChange($event)">
                    <mat-tab>
                        <ng-template mat-tab-label>
                            <!-- <mat-icon class="example-tab-icon p-r-5"> security </mat-icon> -->
                            Security Settings
                        </ng-template>
                        <div class="edit-profile m-t-10">
                            <mat-card-content>
                                <form fxLayout="row wrap" (keydown.enter)="$event.target.tagName == 'TEXTAREA'"
                                    [formGroup]="userPasswrdForm" (ngSubmit)="changePassword()">
                                    <mat-form-field appearance="outline" fxFlex="100">
                                        <mat-label>Current Password*</mat-label>
                                        <input type="password" matInput placeholder="Current Password"
                                            autocomplete="off" formControlName="current_password">
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidpassword}}</mat-error>
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="50" fxFlex.lg="50"
                                        fxFlex.sm="50" fxFlex.xl="50">
                                        <mat-label>New Password*</mat-label>
                                        <input [type]="isTypePassword ? 'password': 'text'" matInput
                                            placeholder="New Password" autocomplete="off"
                                            formControlName="new_password">
                                        <mat-icon matSuffix
                                            matTooltip="Password must contain at least 8 characters, including UPPER, lowercase, special character and numbers."
                                            matTooltipPosition="above">error_outline</mat-icon>
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidpassword}}</mat-error>

                                    </mat-form-field>
                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="50" fxFlex.lg="50"
                                        fxFlex.sm="50" fxFlex.xl="50">
                                        <mat-label>Confirm New Password*</mat-label>
                                        <input [type]="isTypePassword ? 'password': 'text'" matInput
                                            placeholder="Confirm New Password" autocomplete="off"
                                            formControlName="confirmPassword">
                                        <mat-icon matSuffix (click)="changeInputType()">
                                            {{isTypePassword ? 'visibility' : 'visibility_off'}}</mat-icon>
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidpassword}}</mat-error>
                                    </mat-form-field>

                                    <div class="text-center w-100">
                                        <button mat-stroked-button (click)="cancel()" type="button"
                                            class="outline-danger">Cancel</button>
                                        <button mat-stroked-button class="m-l-10 outline-success">
                                            Save </button>
                                    </div>
                                </form>
                            </mat-card-content>
                        </div>
                    </mat-tab>


                    <mat-tab>
                        <ng-template mat-tab-label>
                            Account Settings
                        </ng-template>
                        <div class="edit-profile m-t-10" *ngIf="user?.role_id == 2">
                            <mat-card-content>
                                <form fxLayout="row wrap" (keydown.enter)="$event.target.tagName == 'TEXTAREA'"
                                    [formGroup]="userForm" (ngSubmit)="userformSubmit()">
                                    <div class="sub-title p-l-10" fxFlex="100">Account Number:
                                        {{user?.account_no | mask: '0000-0000-0000'}}
                                    </div>

                                    <mat-form-field appearance="outline" fxFlex="100" class="m-t-5">
                                        <mat-label>Company Name{{user?.organization_type != 'INDV' ? '*' : ''}}
                                        </mat-label>
                                        <input matInput placeholder="Company Name" formControlName="company_name"
                                            autocomplete="off">
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidcompanyname}}</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="30" fxFlex.lg="30"
                                        fxFlex.xl="30" fxFlex.sm="50" fxFlex.xs="100">
                                        <mat-label>First Name*</mat-label>
                                        <input matInput placeholder="First Name" formControlName="first_name"
                                            autocomplete="off">
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidfirstname}}</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="30" fxFlex.lg="30"
                                        fxFlex.xl="30" fxFlex.sm="50" fxFlex.xs="100">
                                        <mat-label>Middle Name/MI</mat-label>
                                        <input matInput placeholder="Middle Name/MI" formControlName="middle_name"
                                            autocomplete="off">
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidmiddlename}}</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="30" fxFlex.lg="30"
                                        fxFlex.xl="30" fxFlex.sm="50" fxFlex.xs="70">
                                        <mat-label>Last Name*</mat-label>
                                        <input matInput placeholder="Last Name" formControlName="last_name"
                                            autocomplete="off">
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidlastname}}</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="10" fxFlex.lg="10"
                                        fxFlex.xl="10" fxFlex.sm="50" fxFlex.xs="30">
                                        <mat-label>Suffix</mat-label>
                                        <input matInput placeholder="Suffix" formControlName="suffix"
                                            autocomplete="off">
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidsuffix}}</mat-error>
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.lg="50"
                                        fxFlex.xl="50" fxFlex.sm="100" fxFlex.xs="100">
                                        <mat-label>Signin Email*</mat-label>
                                        <input matInput placeholder="Signin Email" formControlName="sign_in_email_id"
                                            autocomplete="off">
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidemail}}</mat-error>
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.lg="50"
                                        fxFlex.xl="50" fxFlex.sm="100" fxFlex.xs="100">
                                        <mat-label>County</mat-label>
                                        <input matInput placeholder="County" formControlName="county"
                                            autocomplete="off">
                                        <!-- <mat-error>Error Message Here...</mat-error> -->
                                    </mat-form-field>
                                    <div class="sub-title p-l-10" fxFlex="100" fxFlex.md="100" fxFlex.sm="100"
                                        fxFlex.xs="100">Signature
                                        <br /> <small>
                                            Supported File Formats are JPEG/JPG/PNG with 4:1 Aspect Ratio, 600*150
                                            pixels & Maximum File Size: 3 MB
                                        </small>
                                    </div>
                                    <div fxFlex="100" fxFlex.lg="50" fxFlex.xl="50" fxFlex.md="50" fxFlex.sm="50"
                                        fxFlex.xs="100" class="sign-upload">
                                        <div fxLayout="row wrap" fxFlex="100">
                                            <mat-form-field appearance="standard"
                                                hideRequiredMarker="hideRequiredControl.auto"
                                                floatLabel="floatLabelControl.auto">
                                                <input matInput [title]="selectedFile ? selectedFile : ''" readonly
                                                    [value]="selectedFile | ellipsis:50" placeholder="No file chosen"
                                                    value="12345">
                                                <input type="file" #uploader accept=".png, .jpg, .jpeg" hidden
                                                    (change)="fileChangeEvent($event)" id="uploadFile">

                                            </mat-form-field>

                                            <button matSuffix type="button" (click)="uploader.click()"
                                                mat-stroked-button class="upload_btn outline-success m-t-3">Upload
                                            </button>

                                            <div fxFlex="100" *ngIf="!signData" class="m-t-20">
                                                <div class="empty-image m-l-10">
                                                    No image uploaded
                                                </div>
                                            </div>
                                            <div fxFlex="100" *ngIf="signData" class="m-t-20 sign-img">
                                                <button type="button" class="m-b-5" (click)="removeSign()"
                                                    mat-stroked-button>Remove </button><br />
                                                <div class="sign m-l-10">
                                                    <img [src]="signData">
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                    <!-- <div class="sub-title p-l-10 m-t-20" fxFlex="100" fxFlex.md="100" fxFlex.sm="100"
                                        fxFlex.xs="100">Payment Information
                                    </div>

                                    <mat-form-field appearance="outline" fxFlex="100" class="m-t-10">
                                        <mat-label>Accounting Name*</mat-label>
                                        <input matInput placeholder="Accounting Name" autocomplete="off">
                                        <mat-error>error msg here..</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="50" fxFlex.lg="50"
                                        fxFlex.xl="50" fxFlex.sm="50" fxFlex.xs="100">
                                        <mat-label>Accounting Phone </mat-label>
                                        <input matInput placeholder="Accounting Phone" autocomplete="off">
                                        <mat-error>error msg here..</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="50" fxFlex.lg="50"
                                        fxFlex.xl="50" fxFlex.sm="50" fxFlex.xs="100">
                                        <mat-label>Accounting Email</mat-label>
                                        <input matInput placeholder="Accounting Email" autocomplete="off">
                                        <mat-error>error msg here..</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="33.3" fxFlex.lg="33.3"
                                        fxFlex.xl="33.3" fxFlex.sm="50" fxFlex.xs="100">
                                        <mat-label>City*</mat-label>
                                        <input matInput placeholder="City" autocomplete="off">
                                        <mat-error>error msg here..</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="33.3" fxFlex.lg="33.3"
                                        fxFlex.xl="33.3" fxFlex.sm="50" fxFlex.xs="100">
                                        <mat-label>State*</mat-label>
                                        <input matInput placeholder="State" autocomplete="off">
                                        <mat-error>error msg here..</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="33.3" fxFlex.lg="33.3"
                                        fxFlex.xl="33.3" fxFlex.sm="50" fxFlex.xs="100">
                                        <mat-label>Zip Code*</mat-label>
                                        <input matInput placeholder="Zip Code" autocomplete="off">
                                        <mat-error>error msg here..</mat-error>
                                    </mat-form-field> -->

                                    <!-- <div class="sub-title p-l-10" fxFlex="100" fxFlex.md="100" fxFlex.sm="100"
                                        fxFlex.xs="100">Credit Card Information
                                    </div>
                                    <mat-form-field appearance="outline" fxFlex="100" class="m-t-10">
                                        <mat-label>Name on card*</mat-label>
                                        <input matInput placeholder="Name on card" autocomplete="off">
                                        <mat-error>error msg here..</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="33.3" fxFlex.lg="33.3"
                                        fxFlex.xl="33.3" fxFlex.sm="50" fxFlex.xs="100">
                                        <mat-label>Credit Card Number*</mat-label>
                                        <input matInput placeholder="Credit Card Number" autocomplete="off">
                                        <mat-error>error msg here..</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="33.3" fxFlex.lg="33.3"
                                        fxFlex.xl="33.3" fxFlex.sm="50" fxFlex.xs="100">
                                        <mat-label>Expiration Date*</mat-label>
                                        <input matInput placeholder="Expiration Date" autocomplete="off">
                                        <mat-error>error msg here..</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="33.3" fxFlex.lg="33.3"
                                        fxFlex.xl="33.3" fxFlex.sm="50" fxFlex.xs="100">
                                        <mat-label>CCV Code</mat-label>
                                        <input matInput placeholder="CCV Code" autocomplete="off">
                                        <mat-error>error msg here..</mat-error>
                                    </mat-form-field> -->

                                    <div class="text-center w-100 m-t-10 m-b-10">
                                        <button (click)="cancel()" mat-stroked-button type="button"
                                            class="outline-danger">Cancel</button>
                                        <button mat-stroked-button class="m-l-10 outline-success">Save </button>
                                    </div>
                                </form>
                            </mat-card-content>
                        </div>
                        <div class="edit-profile m-t-10" *ngIf="user?.role_id != 2">
                            <mat-card-content>
                                <form fxLayout="row wrap" (keydown.enter)="$event.target.tagName == 'TEXTAREA'"
                                    [formGroup]="userForm" (ngSubmit)="userformSubmit()">

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="30" fxFlex.lg="30"
                                        fxFlex.xl="30" fxFlex.sm="50" fxFlex.xs="100" class="">
                                        <mat-label>First Name*</mat-label>
                                        <input matInput placeholder="First Name" formControlName="first_name"
                                            autocomplete="off">
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidfirstname}}</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="30" fxFlex.lg="30"
                                        fxFlex.xl="30" fxFlex.sm="50" fxFlex.xs="100" class=" ">
                                        <mat-label>Middle Name/MI</mat-label>
                                        <input matInput placeholder="Middle Name/MI" formControlName="middle_name"
                                            autocomplete="off">
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidmiddlename}}</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="30" fxFlex.lg="30"
                                        fxFlex.xl="30" fxFlex.sm="80" fxFlex.xs="80" class=" ">
                                        <mat-label>Last Name*</mat-label>
                                        <input matInput placeholder="Last Name" formControlName="last_name"
                                            autocomplete="off">
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidlastname}}</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="10" fxFlex.lg="10"
                                        fxFlex.xl="10" fxFlex.sm="20" fxFlex.xs="20" class="">
                                        <mat-label>Suffix</mat-label>
                                        <input matInput placeholder="Suffix" formControlName="suffix"
                                            autocomplete="off">
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidsuffix}}</mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.lg="50"
                                        fxFlex.xl="50" fxFlex.sm="100" fxFlex.xs="100">
                                        <mat-label>Signin Email*</mat-label>
                                        <input matInput placeholder="Signin Email" formControlName="sign_in_email_id"
                                            autocomplete="off">
                                        <mat-error *ngIf="isSubmit">{{errorMessages?.entervalidemail}}</mat-error>
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.lg="50"
                                        fxFlex.xl="50" fxFlex.sm="100" fxFlex.xs="100">
                                        <mat-label>County</mat-label>
                                        <input matInput placeholder="County" formControlName="county"
                                            autocomplete="off">
                                        <!-- <mat-error>Error Message Here...</mat-error> -->
                                    </mat-form-field>

                                    <div class="sub-title p-l-10" fxFlex="100" fxFlex.md="100" fxFlex.sm="100"
                                        fxFlex.xs="100">Signature

                                        <br /><small>
                                            Supported File Formats are JPEG/JPG/PNG with 4:1 Aspect Ratio, 600*150
                                            pixels & Maximum File Size: 3 MB
                                        </small>
                                    </div>
                                    <div fxFlex="100" fxFlex.lg="50" fxFlex.xl="50" fxFlex.md="50" fxFlex.sm="50"
                                        fxFlex.xs="100" class="sign-upload">
                                        <div fxLayout="row wrap">
                                            <mat-form-field appearance="standard"
                                                hideRequiredMarker="hideRequiredControl.auto"
                                                floatLabel="floatLabelControl.auto" class="w-100">
                                                <input matInput [title]="selectedFile ? selectedFile : ''" readonly
                                                    [value]="selectedFile | ellipsis:50" placeholder="No file chosen"
                                                    value="12345">
                                                <input type="file" #uploader accept=".png, .jpg, .jpeg" hidden
                                                    (change)="fileChangeEvent($event)" id="uploadFile">

                                            </mat-form-field>
                                            <button matSuffix type="button" (click)="uploader.click()"
                                                mat-stroked-button class="upload_btn outline-success">Upload
                                                <!-- <span class="fa fa-upload"></span> -->
                                            </button>

                                            <div fxFlex="100" *ngIf="!signData" class="m-t-20">
                                                <div class="empty-image m-l-10">
                                                    No image uploaded
                                                </div>
                                            </div>
                                            <div fxFlex="100" *ngIf="signData" class="m-t-20 sign-img">
                                                <button type="button" class="m-b-5" (click)="removeSign()"
                                                    mat-stroked-button>Remove </button><br />
                                                <div class="sign m-l-10">
                                                    <img [src]="signData">
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="text-center w-100 m-t-10 m-b-10">
                                        <button mat-stroked-button type="button" class="outline-danger"
                                            (click)="cancel()">Cancel</button>
                                        <button mat-stroked-button class="m-l-10 outline-success">Save </button>
                                    </div>
                                </form>
                            </mat-card-content>
                        </div>
                    </mat-tab>

                    <!-- <mat-tab *ngIf="user?.role_id == 2">
                        <ng-template mat-tab-label>
                            Invoice History
                        </ng-template>
                        <div class="edit-profile m-t-10">
                            <mat-card-content>
                                <div class="user-detail">
                                    <table mat-table [dataSource]="dataSource" multiTemplateDataRows
                                        class="mat-elevation-z8 user-table" matSort>
                                        <ng-container matColumnDef="{{column}}"
                                            *ngFor="let column of columnsToDisplay; let i=index">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header
                                                [disabled]="columnName[i] == 'Action'">{{columnName[i]}}</th>
                                            <td mat-cell *matCellDef="let element">
                                                <span *ngIf="i == 0 && isMobile">
                                                    <mat-icon mat-raised-button
                                                        [ngClass]="{'table-expand': expandId == element.id, 'expand-close': !(expandId == element.id)}">
                                                        {{ expandId == element.id ? 'remove_circle' : 'add_circle'}}
                                                    </mat-icon>
                                                </span>
                                                <div>
                                                    <span *ngIf="column == 'invoice_number'">
                                                        {{element?.invoice_number}}
                                                    </span>
                                                    <span *ngIf="column == 'amount'">{{element?.amount}}</span>
                                                    <span *ngIf="column == 'status'">{{element?.status}}</span>
                                                    <span *ngIf="column == 'date'">{{element?.date}}</span>
                                                    <span *ngIf="column == 'action'"><a
                                                            class="text-success">{{element?.action}}</a></span>
                                                </div>
                                            </td>
                                        </ng-container>
                                        <ng-container matColumnDef="expandedDetail">
                                            <td mat-cell *matCellDef="let element"
                                                [attr.colspan]="columnsToDisplay.length">
                                                <div class="detail"
                                                    [@detailExpand]="expandId === element.id ? 'expanded' : 'collapsed'">
                                                    <div class="responsive-table">
                                                        <div><span>Invoice Number</span><span>
                                                                {{element?.invoice_number}}
                                                            </span></div>
                                                        <div><span>Amount</span><span> {{element?.amount}}</span></div>
                                                        <div><span>Status</span><span> {{element?.status}}</span></div>
                                                        <div><span>Date</span><span> {{element?.date}}</span></div>
                                                        <div><span>Action</span><span><a
                                                                    class="text-success">{{element?.action}}</a></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </ng-container>
                                        <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
                                        <tr mat-row *matRowDef="let element; columns: columnsToDisplay;" class="row"
                                            [class.row]="expandedElement === element" (click)="openElement(element)">
                                        </tr>
                                        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']"
                                            class="detail-row"></tr>
                                    </table>
                                    <app-nodata *ngIf="dataSource?.filteredData?.length == 0"></app-nodata>
                                </div>

                                <mat-paginator [pageSizeOptions]="[10, 25, 100]"></mat-paginator>
                            </mat-card-content>
                        </div>
                    </mat-tab> -->

                    <mat-tab>
                        <ng-template mat-tab-label>
                            Payment Settings
                        </ng-template>
                        <div class="edit-profile payment-setting">
                            <mat-card-content>
                                <form fxLayout="row wrap">
                                    <div fxFlex="70" fxFlex.sm="100" fxFlex.xs="100">
                                        <div fxFlex="70" fxFlex.sm="100" fxFlex.xs="100" class="note m-t-0"
                                            *ngIf="!isAddCreditCard">
                                            <div class="p-t-30">
                                                <mat-icon>info</mat-icon> Note : Maximum number of cards per Subscriber
                                                is 5 only
                                            </div>
                                        </div>
                                    </div>
                                    <!-- <mat-form-field class="example-full-width" fxFlex="50" appearance="outline">
                                        <input type="text" placeholder="Default payment preference" aria-label="Number"
                                            matInput [formControl]="myControl" [matAutocomplete]="auto">
                                        <mat-autocomplete #auto="matAutocomplete">
                                            <mat-option *ngFor="let option of options" [value]="option">
                                                {{option}}
                                            </mat-option>
                                        </mat-autocomplete>
                                    </mat-form-field> -->
                                    <div fxFlex="30" fxFlex.sm="100" fxFlex.xs="100">
                                        <button mat-raised-button *ngIf="!isAddCreditCard" (click)="addCard()"
                                            class="float-right filled-gray m-b-10"><i class="fa fa-file-medical"></i>
                                            Add Card</button>
                                    </div>
                                </form>
                                <div fxLayout="row wrap" *ngIf="!isAddCreditCard">
                                    <div class="basic-table striped_ default-cursor p-l-10" fxFlex="100">
                                        <table mat-table [dataSource]="cardDataSource" class="w-100 user-table">

                                            <ng-container matColumnDef="card_img">
                                                <th mat-header-cell *matHeaderCellDef></th>
                                                <td mat-cell *matCellDef="let element" style="width: 40px;"> <img
                                                        [src]="showImage(element.brand)" alt=""
                                                        style="max-width: 35px;">
                                                </td>
                                            </ng-container>


                                            <ng-container matColumnDef="credit_card">
                                                <th mat-header-cell *matHeaderCellDef>Credit Card</th>
                                                <td mat-cell *matCellDef="let element"> {{element.brand}} card ending in
                                                    {{element.last4}} </td>
                                            </ng-container>

                                            <ng-container matColumnDef="default_card">
                                                <th mat-header-cell *matHeaderCellDef>Default Card</th>
                                                <td mat-cell *matCellDef="let element, let i=index">
                                                    <button *ngIf="i != 0"
                                                        (click)="$event.stopPropagation();updateCustomer(element)"
                                                        class="filled-lightgray mini-btn" mat-raised-button>Set as
                                                        Default Payment Card</button>
                                                    <div *ngIf="i == 0" class="font-13">Current Default Card</div>
                                                </td>
                                            </ng-container>


                                            <ng-container matColumnDef="action">
                                                <th mat-header-cell *matHeaderCellDef class="text-center"> Action</th>
                                                <td mat-cell *matCellDef="let element, let i=index" class="text-center">
                                                    <a class="text-success"
                                                        (click)="$event.stopPropagation();editCard(element, i)">
                                                        Edit
                                                    </a>
                                                    <a class="text-danger m-l-10"
                                                        (click)="$event.stopPropagation();deleteCard(element)">
                                                        Remove
                                                    </a>
                                                </td>
                                            </ng-container>
                                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                                        </table>

                                    </div>
                                </div>

                                <div>
                                    <div class="cell pay-type pay" id="example-5">
                                        <form [formGroup]="billings">
                                            <!-- <div id="pay-paymentRequest">

                                            </div> -->
                                            <fieldset *ngIf="isAddCreditCard">
                                                <div fxLayout="row wrap">
                                                    <div class="sub-title p-l-10" fxFlex="100"><span>{{isUpdate ?
                                                            'Update' : 'Add'}}</span> Card</div>
                                                </div>
                                                <div class="row">
                                                    <div class="field">
                                                        <mat-form-field fxFlex="100" fxFlex.sm="100" fxFlex.xs="100">
                                                            <mat-label>Name*</mat-label>
                                                            <input matInput placeholder="Full Name"
                                                                formControlName="name" autocomplete="off">
                                                            <mat-error *ngIf="isCardSubmit">
                                                                Please enter a valid name</mat-error>
                                                        </mat-form-field>
                                                        <!-- <label for="name"
                                                            data-tid="elements_examples.form.name_label">Name on
                                                            Card*</label>
                                                        <input id="name" matInput name="name"
                                                            data-tid="elements_examples.form.name_placeholder"
                                                            class="input" type="text" placeholder="Full Name"
                                                            formControlName="name" required autocomplete="name">
                                                        <mat-error *ngIf="billings.hasError('required')">
                                                            Please enter a name
                                                        </mat-error> -->
                                                    </div>
                                                </div>

                                                <div data-locale-reversible class="row" fxLayout="row wrap">
                                                    <!-- <div class="field" fxFlex="50">
                                                        <label for="phone"
                                                            data-tid="elements_examples.form.address_label">Phone</label>
                                                        <input id="phone" matInput name="phone"
                                                            data-tid="elements_examples.form.address_placeholder"
                                                            class="input" type="text" (keypress)="numberOnly($event)"
                                                            mask="(000) 000-0000" placeholder="Phone"
                                                            formControlName="phone" autocomplete="address-line1">
                                                    </div>
                                                    <div class="field" fxFlex="50">
                                                        <label for="email"
                                                            data-tid="elements_examples.form.address_label">Email</label>
                                                        <input id="email" matInput name="email"
                                                            data-tid="elements_examples.form.address_placeholder"
                                                            class="input" type="text" formControlName="email"
                                                            placeholder="Email" autocomplete="address-line1">
                                                    </div> -->
                                                    <!-- <div formGroupName="address"> -->
                                                    <mat-form-field fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                        <mat-label>Street Address 1</mat-label>
                                                        <input matInput placeholder="Street Address 1"
                                                            formControlName="address_line1" autocomplete="off">
                                                    </mat-form-field>

                                                    <mat-form-field fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                        <mat-label>Street Address 2</mat-label>
                                                        <input matInput placeholder="Street Address 2"
                                                            formControlName="address_line2" autocomplete="off">
                                                    </mat-form-field>
                                                    <!-- <div class="field" fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                        <label for="street_address_1"
                                                            data-tid="elements_examples.form.address_label">Street Address 1</label>
                                                        <input id="street_address_1" matInput name="line1"
                                                            data-tid="elements_examples.form.address_placeholder"
                                                            class="input" type="text" placeholder="Street Address 1"
                                                            formControlName="address_line1"
                                                            autocomplete="address-line1">
                                                    </div> -->
                                                    <!-- <div class="field" fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                        <label for="street_address_2"
                                                            data-tid="elements_examples.form.address_label">Street
                                                            Address
                                                            2</label>
                                                        <input id="street_address_2" matInput name="line2"
                                                            data-tid="elements_examples.form.address_placeholder"
                                                            class="input" type="text" placeholder="Street Address 2"
                                                            formControlName="address_line2"
                                                            autocomplete="address-line1">
                                                    </div> -->

                                                    <div data-locale-reversible class="row" fxFlex="100"
                                                        fxLayout="row wrap">

                                                        <mat-form-field fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                            <mat-label>City</mat-label>
                                                            <input matInput placeholder="City"
                                                                formControlName="address_city" autocomplete="off">
                                                        </mat-form-field>

                                                        <mat-form-field fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                            <mat-label>State</mat-label>
                                                            <mat-select formControlName="address_state"
                                                                (selectionChange)="changeState($event.value)">
                                                                <mat-select-trigger>
                                                                    {{cardState}}
                                                                </mat-select-trigger>
                                                                <mat-option *ngFor="let state of states"
                                                                    [value]="state.state_code">{{state.state_code}} -
                                                                    {{state.state}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                        <mat-form-field fxFlex="50" fxFlex.sm="100" fxFlex.xs="100"
                                                            *ngIf="isUpdate">
                                                            <mat-label>Zip</mat-label>
                                                            <input matInput placeholder="Zip" mask="00000"
                                                                formControlName="address_zip" autocomplete="off">
                                                            <mat-error *ngIf="isCardSubmit">
                                                                Please enter a valid zipcode</mat-error>
                                                        </mat-form-field>

                                                        <div fxFlex="50">
                                                            <mat-checkbox formControlName="default" class="checkbox_">
                                                                Set as Default Payment Card
                                                            </mat-checkbox>
                                                        </div>


                                                        <!-- <div class="field" fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                            <label for="pay-city"
                                                                data-tid="elements_examples.form.city_label">City</label>
                                                            <input id="pay-city" matInput name="city"
                                                                data-tid="elements_examples.form.city_placeholder"
                                                                class="input" type="text" placeholder="City"
                                                                formControlName="address_city"
                                                                autocomplete="address-level2">
                                                        </div> -->
                                                        <!-- <div class="field" fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                            <label for="pay-state"
                                                                data-tid="elements_examples.form.state_label">State</label>
                                                            <input id="pay-state" matInput name="state"
                                                                data-tid="elements_examples.form.state_placeholder"
                                                                class="input empty" type="text"
                                                                formControlName="address_state" placeholder="State"
                                                                autocomplete="address-level1"> 
                                                            <mat-select formControlName="address_state"
                                                                (selectionChange)="changeState($event.value)"
                                                                class="custom-mat-select">
                                                                <mat-select-trigger>
                                                                    {{cardState}}
                                                                </mat-select-trigger>
                                                                <mat-option *ngFor="let state of states"
                                                                    [value]="state.state_code">{{state.state_code}} -
                                                                    {{state.state}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </div> -->
                                                        <!-- </div> -->
                                                    </div>
                                                    <div data-locale-reversible class="row" fxFlex="100"
                                                        fxLayout="row wrap" *ngIf="isUpdate">

                                                        <mat-form-field fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                            <mat-label>Expiration Month </mat-label>
                                                            <mat-select formControlName="exp_month"
                                                                class="custom-mat-select">
                                                                <mat-option *ngFor="let month of months"
                                                                    [value]="month">{{month}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>

                                                        <mat-form-field fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                            <mat-label>Expiration Year </mat-label>
                                                            <mat-select formControlName="exp_year"
                                                                class="custom-mat-select">
                                                                <mat-option *ngFor="let year of years" [value]="year">
                                                                    {{year}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>


                                                        <!-- <div class="field" fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                            <label for="pay-month"
                                                                data-tid="elements_examples.form.month_label">Expiry
                                                                Month</label>
                                                             <input id="pay-month" matInput name="month"
                                                                data-tid="elements_examples.form.month_placeholder"
                                                                class="input" type="text" placeholder="Expiry Month"
                                                                formControlName="exp_month"
                                                                autocomplete="address-level2">
                                                            <mat-select formControlName="exp_month"
                                                                class="custom-mat-select">
                                                                <mat-option *ngFor="let month of months"
                                                                    [value]="month">{{month}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </div> -->
                                                        <!-- <div class="field" fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                            <label for="pay-year"
                                                                data-tid="elements_examples.form.year_label">Expiry Year</label>
                                                             <input id="pay-year" matInput name="year"
                                                                data-tid="elements_examples.form.year_placeholder"
                                                                class="input empty" type="text"
                                                                formControlName="exp_year" placeholder="Expiry Year"
                                                                autocomplete="address-level1"> 
                                                            <mat-select formControlName="exp_year"
                                                                class="custom-mat-select">
                                                                <mat-option *ngFor="let year of years" [value]="year">
                                                                    {{year}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </div> -->
                                                        <!-- </div> -->
                                                    </div>
                                                </div>
                                            </fieldset>
                                            <div class="row pay-type" fxLayout="row wrap">
                                                <div class="p-l-20 m-t-10" fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                                    <label for="pay-card" data-tid="elements_examples.form.card_label"
                                                        *ngIf="isAddCreditCard && !isUpdate">Card</label>
                                                    <div *ngIf="!hideCard" id="card-info" #cardInfo></div>
                                                </div>
                                            </div>
                                            <div class="text-center w-100 p-t-10" *ngIf="isAddCreditCard">
                                                <button mat-stroked-button type="button" class="outline-danger"
                                                    (click)="cancleAddCard()">Cancel</button>
                                                <button type="submit" [disabled]="isAddingCard" mat-stroked-button
                                                    class="outline-success m-l-10" (click)="createStripeToken()">Save
                                                    Card</button>
                                            </div>

                                        </form>
                                    </div>
                                </div>
                            </mat-card-content>
                        </div>
                    </mat-tab>
                    <mat-tab>
                        <ng-template mat-tab-label>
                            Payment History
                        </ng-template>
                        <mat-card-content class="payment-history w-100" fxLayout="row wrap">
                            <div class="sub-title" fxFlex="100">Charges</div>
                            <div fxLayout="row wrap" class="charges" fxFlex="100">
                                <div fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                    <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="50" fxFlex.lg="50"
                                        fxFlex.xl="50" fxFlex.sm="50" fxFlex.xs="100">
                                        <mat-label>Date</mat-label>
                                        <mat-select [(ngModel)]="selectedDate" name="selectedDate"
                                            [value]="selectedDate">
                                            <mat-option *ngFor="let date of subscriptionCharges"
                                                (click)="getHistory(date.date)" [value]="date.date">
                                                {{date.date}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                                <div *ngIf="isDataAvailable" fxFlex="50" fxFlex.sm="100" fxFlex.xs="100" class="text-right">
                                    <button (click)="downloadCSV()" mat-raised-button class="filled-lightgray m-t-15">Download CSV</button>
                                </div>
                            </div>
                            <div fxLayout="row wrap" class="estimation" fxFlex="100">
                                <div fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
                                    <div class="sub-title">{{currentMonth == selectedMonth ? 'Current Usage Total' :
                                        'Bill Total'}}</div>
                                </div>
                                <div fxFlex="50" fxFlex.sm="100" fxFlex.xs="100" class="text-right">
                                    <div class="sub-title" fxFlex="100">{{paymentData?.bill_total ?
                                        ("$"+(paymentData?.bill_total| number : '1.2-2')) : ""}}
                                    </div>
                                </div>
                                <div class="divider"></div>
                                <div class="note" fxFlex="100" *ngIf="currentMonth == selectedMonth">The total charge
                                    will be displayed when the invoice is
                                    complete.</div>
                            </div>
                            <div fxLayout="row wrap" class="details" fxFlex="100" *ngIf="isDataAvailable">
                                <div fxFlex="50">
                                    <div class="sub-title m-t-10">Details</div>
                                </div>
                                <div fxFlex="50" class="text-right m-b-5">
                                    <button (click)="expandAll()" mat-raised-button
                                        class="filled-lightgray mini-btn m-t-15">
                                        <i class="fas fa-plus"></i> {{isExpanded ? "Collapse All" : "Expand All"}}
                                    </button>
                                </div>
                                <div class="divider"></div>
                            </div>
                            <div fxLayout="row wrap" class="details m-t-10" fxFlex="100">
                                <mat-tree #tree [dataSource]="dataSourceList" [treeControl]="treeControl"
                                    class="pay-list">
                                    <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding
                                        matTreeNodePaddingIndent="10">
                                        <button mat-icon-button disabled></button>

                                        <div [class]="'pay-records pay-records-expand node'+node?.level">
                                            <!-- <span>{{node.name}}</span>
                                            <span>&nbsp;{{node.pages ? node.pages : " "}}</span>
                                            <span><b> {{node.charges ? ("$"+ (node.charges | number : '1.2-2')) :
                                                    "$0.00"}}</b></span> -->
                                            <div class="property">{{node.name}}</div>
                                            <div class="items hide-mobile">
                                                <p>&nbsp;{{node.pages ? node.pages : " "}}</p>
                                            </div>
                                            <div class="show-mobile"><b>{{node.pages ? node.pages : " "}}</b></div>
                                            <div class="total">{{node.charges ? ("$"+ (node.charges | number : '1.2-2'))
                                                : "$0.00"}}</div>

                                        </div>
                                    </mat-tree-node>
                                    <mat-tree-node *matTreeNodeDef="let node;when: hasChild" matTreeNodePadding
                                        matTreeNodePaddingIndent="10">
                                        <button mat-icon-button matTreeNodeToggle
                                            [attr.aria-label]="'toggle ' + node.name" disableRipple="true">
                                            <mat-icon class="mat-icon-rtl-mirror">
                                                {{treeControl.isExpanded(node) ? 'arrow_drop_down' : 'arrow_right'}}
                                            </mat-icon>
                                        </button>
                                        <div [class]="'pay-records node'+node?.level">
                                            <!-- <span><b>{{node.name}}</b></span>
                                            <span>&nbsp;{{node.pages}}</span>
                                            <span><b> {{node.charges ? ("$"+ (node.charges | number : '1.2-2')) :
                                                    "$0.00"}}</b></span> -->
                                            <div class="property"><b>{{node.name}}</b></div>
                                            <div class="items hide-mobile">
                                                <p>&nbsp;</p>
                                            </div>
                                            <div class="total"><b>{{node.charges ? ("$"+ (node.charges | number :
                                                    '1.2-2')) : "$0.00"}}</b></div>
                                            <div class="divider"></div>
                                        </div>

                                    </mat-tree-node>
                                </mat-tree>
                            </div>
                        </mat-card-content>
                    </mat-tab>
                </mat-tab-group>
            </mat-card>
        </div>
    </div>
</div>