<div class="claimant-info" fxLayout="row wrap">
    <div fxFlex="33.3" fxFlex.sm="100" fxFlex.xs="100">
        <div fxLayout="row wrap" fxFlex="100">
            <div class="grid-list">
                <div>Claimant</div>
                <div>{{examinationDetails?.claimant_name?.first_name}}
                    {{examinationDetails?.claimant_name?.middle_name}}
                    {{examinationDetails?.claimant_name?.last_name}} </div>
            </div>
            <div class="grid-list">
                <div>SSN</div>
                <div>{{examinationDetails?.ssn | mask: '999-99-9999'}}</div>
            </div>

            <div class="grid-list">
                <div>DOB</div>
                <div>{{examinationDetails?.dob | date:'MM-dd-yyyy'}}</div>
            </div>
            <div class="grid-list empty-list hide-mobile hide-sm">
                <div>&nbsp;</div>
                <div></div>
            </div>
        </div>
    </div>

    <div fxFlex="33.3" fxFlex.sm="100" fxFlex.xs="100">
        <div fxLayout="row wrap" fxFlex="100">
            <div class="grid-list">
                <div>Exam</div>
                <div>{{examinationDetails?.exam_type_code}} - {{examinationDetails?.exam_type_name}} </div>
            </div>
            <div class="grid-list">
                <div>Claim Number</div>
                <div>{{examinationDetails?.claim_details?.claim_number}}</div>
            </div>

            <div class="grid-list">
                <div>DOI</div>
                <div>{{examinationDetails?.doi | date:'MM-dd-yyyy'}}</div>
            </div>
            <div class="grid-list empty-list hide-mobile hide-sm">
                <div>&nbsp;</div>
                <div></div>
            </div>
        </div>
    </div>

    <div fxFlex="33.3" fxFlex.sm="100" fxFlex.xs="100">
        <div fxLayout="row wrap">
            <div fxFlex="100">
                <div class="grid-list">
                    <div>Exam Procedure</div>
                    <div>
                        {{examinationDetails?.exam_procedure_name}}</div>
                </div>
                <div class="grid-list">
                    <div>Examiner</div>
                    <div>{{examinationDetails?.examiner_name?.first_name}}
                        {{examinationDetails?.examiner_name?.middle_name}}
                        {{examinationDetails?.examiner_name?.last_name}}</div>
                </div>

                <div class="grid-list">
                    <div>DOS</div>
                    <div>{{examinationDetails?.date_of_service | date:'MM-dd-yyyy'}}</div>
                </div>
                <div class="grid-list" *ngIf="isSuplimental">
                    <div>Date Item Received</div>
                    <div>{{billableData?.intake_call?.call_date | date:'MM-dd-yyyy'}}</div>
                </div>
            </div>

            <div fxFlex="100">
                <div class="grid-list">
                    <div>Report Submission Due Date</div>
                    <div>{{examinationDetails?.over_due_date | date:'MM-dd-yyyy'}}</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="border-dashed-blue m-t-30"></div>


<div class="action-info w-100" fxLayout="row wrap p-t-0">
    <div fxFlex="100" fxFlex.sm="100" fxFlex.xs="100">
        <div class="logo-caption text-left"> <span class="primary">Simple</span><span
                class="ternary">Service</span><sup>®</sup>
            <span class="note p-l-10">This would be a brief description on the benefits of these services</span>
        </div>
    </div>
    <div *ngFor="let status of procedureTypeList" fxFlex="33.3" fxFlex.sm="50" fxFlex.xs="100" [hidden]="status?.skip">
        <div class="simple-card" *ngIf="!(status.name === 'Billing' && role == '4')"
            [ngClass]="{'billing-status-active bg_light': status.name === 'Billing'}" (click)="clickNav(status.url)">
            <i [class]="status.icon"></i>
            <div class="p-l-10 text-center">
                <h4>{{status.name}}</h4>
                <span *ngIf="progressStatus[status.progress_name]">{{progressStatus[status.progress_name]}}</span>
                <div *ngIf="!progressStatus[status.progress_name]"></div>
            </div>
        </div>
    </div>
    <!-- <div fxFlex="33.3" fxFlex.sm="50" fxFlex.xs="100">
        <div class="simple-card billing-status-active bg_light" (click)="billingNev()">
            <i class="fa fa-usd"></i>
            <div class="p-l-10 text-center">
                <h4>Billing</h4>
                <span *ngIf="progressStatus?.billing">{{progressStatus?.billing}}</span>
                <div *ngIf="!progressStatus?.billing"></div>
            </div>
        </div>
    </div> -->
</div>

<div class="border-dashed-blue m-t-20" *ngIf="isDisplayStatus.status"></div>
<mat-card class="exam-status" *ngIf="!isSuplimental">
    <div class="exam-info w-100" fxLayout="row wrap" *ngIf="isDisplayStatus.status">
        <div fxFlex="50" fxFlex.sm="100" fxFlex.xs="100" class="show-mobile show-sm">
            <!--  *ngIf="!isExamTypeChanged || !isFreeze" -->
            <span>
                <!-- [disabled]="disableExaminationArr.includes(examinationDetails?.appointments?.examination_status) || isFreeze" -->
                <button *ngIf="!isExaminationStatusEdit" mat-raised-button (click)="changeEditStatus()"
                    class="filled-gray edit_btn">Edit</button>
                <!-- [disabled]="disableExaminationArr.includes(examinationDetails?.appointments?.examination_status) || isFreeze" -->
                <button *ngIf="isExaminationStatusEdit" type="submit" mat-raised-button
                    (click)="examinationStatusSubmit()" class="filled-success edit_btn">Save</button>
            </span>
        </div>
        <div fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
            <form [formGroup]="examinationStatusForm">
                <div fxLayout="row wrap" class="examination-status">
                    <div fxFlex="30" fxFlex.sm="100" fxFlex.xs="100" class="p-t-15 p-r-10">{{isDisplayStatus.name}}
                        Status</div>
                    <mat-form-field appearance="outline" fxFlex="70" fxFlex.sm="100" fxFlex.xs="92">
                        <mat-label>Choose an option</mat-label>
                        <mat-select formControlName="examination_status">
                            <mat-option *ngFor="let examination_status of examinationStatus"
                                [value]="examination_status.id">
                                {{examination_status[isDisplayStatus.isExaminar ? 'examination_status' :
                                'examination_status']}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <span *ngIf="!isIME" class="custom-info regulation"
                        (click)="openPopupRegulation(regulation?.regulationsForAppointmentNotification?.title, regulation?.regulationsForAppointmentNotification?.codes)"><i
                            class="material-icons-outlined">info</i><sup>Regulations</sup></span>
                    <mat-form-field appearance="outline" fxFlex="100" class="notes">
                        <mat-label>Notes</mat-label>
                        <textarea formControlName="examination_notes" matInput placeholder="Notes" cdkTextareaAutosize
                            cdkAutosizeMinRows="1" cdkAutosizeMaxRows="1"></textarea>
                    </mat-form-field>
                </div>
                <div *ngIf="isExaminationStatusEdit" class="text-center w-100">
                    <button mat-stroked-button class="outline-danger" (click)="cancel()">Cancel</button>
                    <button mat-stroked-button class="m-l-10 outline-success" type="submit"
                        (click)="examinationStatusSubmit()">Save
                    </button>
                </div>
            </form>
        </div>

        <div fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
            <!--  *ngIf="!isFreeze" -->
            <span>
                <!-- [disabled]="disableExaminationArr.includes(examinationDetails?.appointments?.examination_status) || isFreeze" -->
                <button *ngIf="!isExaminationStatusEdit" mat-raised-button (click)="changeEditStatus()"
                    class="filled-gray edit_btn hide-mobile hide-sm">Edit</button>
                <!-- [disabled]="disableExaminationArr.includes(examinationDetails?.appointments?.examination_status) || isFreeze" -->
                <button *ngIf="isExaminationStatusEdit" mat-raised-button (click)="examinationStatusSubmit()"
                    class="filled-success edit_btn hide-mobile hide-sm">Save</button><br /><br />
            </span>
            <button mat-raised-button class="filled-gray calender_btn" (click)="openCalendar()">View on
                Calendar</button>
        </div>
    </div>
</mat-card>

<!-- Suplimental -->
<mat-card class="exam-status" *ngIf="isSuplimental">
    <div class="exam-info w-100" fxLayout="row wrap" *ngIf="isDisplayStatus.status">
        <div fxFlex="50" fxFlex.sm="100" fxFlex.xs="100" class="show-mobile show-sm">
            <span>
                <button *ngIf="supplemenalStatus.examination_status != 16 && supplemenalStatus.examination_status != 35"
                    mat-raised-button (click)="changeEditStatus()" class="filled-gray edit_btn"
                    [disabled]="isExaminationStatusEdit">Cancel {{procedureType}}</button>
                <button *ngIf="supplemenalStatus.examination_status == 16 || supplemenalStatus.examination_status == 35"
                    type="submit" mat-raised-button (click)="supplementalreopen(16)" class="filled-gray edit_btn">Reopen
                    {{procedureType}}</button>
                <!-- <button *ngIf="supplemenalStatus.examination_status != 16 && supplemenalStatus.examination_status != 35"
                    mat-raised-button (click)="changeEditStatus()" [disabled]="isExaminationStatusEdit"
                    class="filled-gray edit_btn hide-mobile hide-sm">Cancel
                    Supplemental</button>
                <button *ngIf="supplemenalStatus.examination_status == 16 || supplemenalStatus.examination_status == 35"
                    mat-raised-button (click)="supplementalreopen(null)"
                    class="filled-gray edit_btn hide-mobile hide-sm">Reopen
                    Supplemental</button> -->
            </span>
        </div>
        <div fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
            <form [formGroup]="examinationStatusForm">
                <div fxLayout="row wrap" class="examination-status">
                    <div fxFlex="100" fxFlex.sm="100" fxFlex.xs="100" class="m-t-0 p-r-10">{{procedureType ==
                        'IMERecords' ? "IME Records" : procedureType}} {{supplemenalStatus.examination_status == 16 ?
                        "Cancelled" : ""}} <span *ngIf="!isIME" class="custom-info supplemental regulation"
                            (click)="openPopupRegulation(regulation?.regulationsForAppointmentNotification?.title, regulation?.regulationsForAppointmentNotification?.codes)"><i
                                class="material-icons-outlined">info</i><sup>Regulations</sup></span></div>

                    <mat-form-field
                        *ngIf="isExaminationStatusEdit && supplemenalStatus.examination_status != 16 && supplemenalStatus.examination_status != 35"
                        appearance="outline" fxFlex="100" class="notes m-t-15">
                        <mat-label>Cancel Reason</mat-label>
                        <textarea formControlName="examination_notes" matInput placeholder="Cancel Reason"
                            cdkTextareaAutosize cdkAutosizeMinRows="2" cdkAutosizeMaxRows="2"></textarea>
                    </mat-form-field>
                    <div class="cancel-reason supplemental w-100"
                        *ngIf="supplemenalStatus.examination_status == 16 || supplemenalStatus.examination_status == 35">
                        <div class="reason">Cancelled Reason: {{supplemenalStatus.examination_notes ? "" : " -"}}</div>
                        <div class="description">{{supplemenalStatus.examination_notes}}</div>
                    </div>
                </div>
                <div *ngIf="isExaminationStatusEdit" class="text-center w-100">
                    <button mat-stroked-button class="outline-danger" (click)="cancel()">Cancel</button>
                    <button mat-stroked-button class="m-l-10 outline-success" type="submit"
                        (click)="supplementalreopen(16)">Save
                    </button>
                </div>
            </form>
        </div>

        <div fxFlex="50" fxFlex.sm="100" fxFlex.xs="100">
            <span>
                <button *ngIf="supplemenalStatus.examination_status != 16 && supplemenalStatus.examination_status != 35"
                    mat-raised-button (click)="changeEditStatus()" [disabled]="isExaminationStatusEdit"
                    class="filled-gray edit_btn hide-mobile hide-sm">Cancel
                    {{procedureType == 'IMERecords' ? "IME Records" : procedureType}}</button>
                <button *ngIf="supplemenalStatus.examination_status == 16 || supplemenalStatus.examination_status == 35"
                    mat-raised-button (click)="supplementalreopen(null)"
                    class="filled-gray edit_btn hide-mobile hide-sm">Reopen
                    {{procedureType == 'IMERecords' ? "IME Records" : procedureType}}</button>
                <!-- <button *ngIf="!isExaminationStatusEdit" mat-raised-button (click)="changeEditStatus()"
                    class="filled-gray edit_btn hide-mobile hide-sm"
                    [disabled]="disableExaminationArr.includes(examinationDetails?.appointments?.examination_status) || isFreeze">Close</button>
                <button *ngIf="isExaminationStatusEdit" mat-raised-button (click)="examinationStatusSubmit()"
                    class="filled-success edit_btn hide-mobile hide-sm"
                    [disabled]="disableExaminationArr.includes(examinationDetails?.appointments?.examination_status) || isFreeze">Save</button> -->
                <br /><br />
            </span>
        </div>
    </div>
</mat-card>



<div class="border-dashed-blue m-b-50"></div>

<mat-card class="documents-declared m-b-20">
    <mat-card-header>
        <div class="sub-title p-l-10 w-100 p-t-10 p-b-10">Correspondence / Documents Declared<span *ngIf="!isIME"
                class="custom-info regulation"
                (click)="openPopupRegulation(regulation?.regulationsForDeclarationOfPagesReceived?.title, regulation?.regulationsForDeclarationOfPagesReceived?.codes)">
                <i class="material-icons-outlined">info</i><sup>Regulations</sup></span></div>
        <span class="spacer"></span>
        <span>
            <button type="button" class="filled-gray m-b-5" mat-raised-button (click)="addRow()">Add</button>
        </span>
    </mat-card-header>
    <mat-divider> </mat-divider>
    <mat-card-content>
        <!---Documents decleared-->
        <div fxLayout="row wrap" *ngIf="getFormControls.controls.length > 0">
            <div fxFlex="100" class="p-l-0 note">
                <mat-icon>info</mat-icon> Note : Correspondence uploaded here will be included with the billing
                submission documents according to regulation 9793(L)
            </div>
        </div>
        <div class="user-detail hide-mobile">
            <form [formGroup]="docDeclearTable">
                <table class="table table-border res-table" [ngClass]="{'table-dark': mode}"
                    *ngIf="getFormControls.controls.length > 0">
                    <thead class="text-nowrap">
                        <th>Pages Declared</th>
                        <th>Submitting Party</th>
                        <th>Date Received</th>
                        <th>Upload</th>
                        <th class="text-center">Action</th>
                    </thead>
                    <tbody>
                        <ng-container formArrayName="tableRows"
                            *ngFor="let group of getFormControls.controls ; let i=index">
                            <tr *ngIf="group.get('isEditable').value" [formGroupName]="i">
                                <td>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input matInput type="number" (keypress)="numberOnly($event)"
                                            formControlName="no_of_pages_declared" min="1" autocomplete="off"
                                            placeholder="Pages Declared">
                                    </mat-form-field>
                                </td>
                                <td>
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-select placeholder="Select Submitting Party" formControlName="agent_type">
                                            <mat-option *ngFor="let party of SubmittingParty" [value]="party.name">
                                                {{party.name}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </td>
                                <td>
                                    <mat-form-field appearance="outline" class="mat-date-picker">
                                        <input matInput type="text" placeholder="Date Received"
                                            formControlName="date_received" autocomplete="off" [min]="minimumDate"
                                            [matDatepicker]="date_received" [max]="today">
                                        <mat-datepicker-toggle matSuffix [for]="date_received">
                                        </mat-datepicker-toggle>
                                        <mat-datepicker #date_received></mat-datepicker>
                                    </mat-form-field>
                                </td>

                                <td *ngIf="!group.get('file_name').value">
                                    <button type="button" mat-raised-button class="mini-btn filled-gray"
                                        (click)="addFileDoc($event,group,i)">Upload</button>
                                </td>
                                <td *ngIf="group.get('file_name').value">
                                    <a class="text-ternary display-block" (click)="downloadDocDeclare(group,i)">
                                        {{group.get('file_name').value}}</a>
                                    <button type="button" mat-raised-button class="mini-btn filled-gray"
                                        (click)="removeDocDeclare(group,i)">Remove</button>
                                </td>
                                <td class="text-center">
                                    <a class="text-success" (click)="doneRow(group, i)">Save</a>
                                    <a class="text-danger m-l-10" (click)="cancelRow(group,i)">Cancel</a>
                                </td>
                            </tr>

                            <tr *ngIf="!group.get('isEditable').value" [formGroupName]="i" class="values">
                                <td>
                                    {{group.get('no_of_pages_declared').value ? group.get('no_of_pages_declared').value
                                    : '-'}}
                                </td>
                                <td>
                                    {{group.get('agent_type').value ? group.get('agent_type').value : '-'}}
                                </td>
                                <td>
                                    {{group.get('date_received').value ? (group.get('date_received').value |
                                    date:'MM-dd-yyyy') : '-'}}
                                </td>
                                <td *ngIf="group.get('file_name').value">
                                    <a class="text-ternary display-block"
                                        (click)="downloadDocDeclare(group,i)">{{group.get('file_name').value}}</a>
                                    <!-- <button type="button" [disabled]="!group.get('isEditable').value" mat-raised-button class="mini-btn filled-gray" (click)="removeDocDeclare(group,i)">Remove</button> -->
                                </td>
                                <td *ngIf="!group.get('file_name').value">
                                    -
                                    <!-- <button type="button" mat-raised-button class="mini-btn filled-gray" disabled>Upload</button> -->
                                </td>
                                <td class="text-center">
                                    <a class="text-success" (click)="editRow(group,i)">Edit</a>
                                    <a class="text-danger m-l-10" (click)="deleteRow(i,group)">Remove</a>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
                <app-nodata *ngIf="getFormControls?.controls?.length == 0"></app-nodata>
            </form>
        </div>

        <!--Correspondence/ Document - Mobile UI-->
        <div class="bill-response-mobile show-mobile w-100">
            <form [formGroup]="docDeclearTable">
                <table *ngIf="getFormControls.controls.length > 0">
                    <tbody>
                        <ng-container formArrayName="tableRows"
                            *ngFor="let group of getFormControls.controls ; let i=index">
                            <tr *ngIf="!group.get('isEditable').value" [formGroupName]="i">
                                <td>
                                    <mat-accordion>
                                        <mat-expansion-panel
                                            (click)="openElement(group.get('no_of_pages_declared').value)" hideToggle>
                                            <mat-expansion-panel-header>
                                                <mat-panel-title>
                                                    <div class="inline-title">
                                                        <div><b>Pages Declared </b></div>
                                                        <div>: {{group.get('no_of_pages_declared').value ?
                                                            group.get('no_of_pages_declared').value
                                                            : '-'}}</div>
                                                    </div>
                                                </mat-panel-title>
                                            </mat-expansion-panel-header>
                                            <mat-card>
                                                <div class="flex">
                                                    <div class="bill-property">Pages Declared</div>
                                                    <div class="value">{{group.get('no_of_pages_declared').value ?
                                                        group.get('no_of_pages_declared').value
                                                        : '-'}}</div>
                                                </div>
                                                <div class="flex">
                                                    <div class="bill-property">Submitting Party</div>
                                                    <div class="value">{{group.get('agent_type').value ?
                                                        group.get('agent_type').value : '-'}}</div>
                                                </div>
                                                <div class="flex">
                                                    <div class="bill-property">Date Received</div>
                                                    <div class="value">{{group.get('date_received').value ?
                                                        (group.get('date_received').value |
                                                        date:'MM-dd-yyyy') : '-'}}</div>
                                                </div>
                                                <div class="flex">
                                                    <div class="bill-property">Upload</div>
                                                    <div class="value" *ngIf="group.get('file_name').value">
                                                        <a class="text-ternary display-block"
                                                            (click)="downloadDocDeclare(group,i)">{{group.get('file_name').value}}</a>
                                                    </div>
                                                    <div class="value" *ngIf="!group.get('file_name').value">
                                                        -
                                                    </div>
                                                </div>
                                                <div class="flex">
                                                    <div class="bill-property">Action</div>
                                                    <div class="value">
                                                        <a class="text-success" (click)="editRow(group,i)">Edit</a>
                                                        <a class="text-danger m-l-10"
                                                            (click)="deleteRow(i,group)">Remove</a>
                                                    </div>
                                                </div>

                                            </mat-card>
                                        </mat-expansion-panel>
                                    </mat-accordion>

                                </td>
                            </tr>
                            <tr *ngIf="group.get('isEditable').value" [formGroupName]="i">
                                <td>
                                    <mat-accordion>
                                        <mat-expansion-panel [expanded]="true" hideToggle>
                                            <mat-expansion-panel-header>
                                                <mat-panel-title>
                                                    <div class="inline-title">
                                                        <div><b>Pages Declared </b></div>
                                                        <div>: {{group.get('no_of_pages_declared').value ?
                                                            group.get('no_of_pages_declared').value
                                                            : '-'}}</div>
                                                    </div>
                                                </mat-panel-title>
                                            </mat-expansion-panel-header>
                                            <mat-card>
                                                <div class="detail m-t-5"
                                                    style="background-color: #ffffff;padding: 10px;">
                                                    <div class="expand-details-list form-level w-100"
                                                        fxLayout="row wrap">
                                                        <div fxFlex.sm="100" fxFlex.xs="100"
                                                            class="expand-details editable">
                                                            <div class="grid-list-form">
                                                                <div class="property">Pages Declared</div>
                                                                <div class="value">
                                                                    <mat-form-field appearance="outline" class="w-100">
                                                                        <input matInput type="number"
                                                                            (keypress)="numberOnly($event)"
                                                                            formControlName="no_of_pages_declared"
                                                                            min="1" autocomplete="off"
                                                                            placeholder="Pages Declared">
                                                                    </mat-form-field>
                                                                </div>
                                                            </div>
                                                            <div class="grid-list-form">
                                                                <div class="property">Submitting Party</div>
                                                                <div class="value">
                                                                    <mat-form-field appearance="outline" class="w-100">
                                                                        <mat-select
                                                                            placeholder="Select Submitting Party"
                                                                            formControlName="agent_type">
                                                                            <mat-option
                                                                                *ngFor="let party of SubmittingParty"
                                                                                [value]="party.name">
                                                                                {{party.name}}
                                                                            </mat-option>
                                                                        </mat-select>
                                                                    </mat-form-field>
                                                                </div>
                                                            </div>
                                                            <div class="grid-list-form">
                                                                <div class="property">Date Received</div>
                                                                <div class="value">
                                                                    <mat-form-field appearance="outline"
                                                                        class="mat-date-picker">
                                                                        <input matInput type="text"
                                                                            placeholder="Date Received"
                                                                            formControlName="date_received"
                                                                            autocomplete="off" [min]="minimumDate"
                                                                            [matDatepicker]="date_received"
                                                                            [max]="today">
                                                                        <mat-datepicker-toggle matSuffix
                                                                            [for]="date_received">
                                                                        </mat-datepicker-toggle>
                                                                        <mat-datepicker #date_received></mat-datepicker>
                                                                    </mat-form-field>
                                                                </div>
                                                            </div>

                                                            <div class="grid-list-form">
                                                                <div class="property"></div>
                                                                <div class="value"
                                                                    *ngIf="!group.get('file_name').value">
                                                                    <button type="button" mat-raised-button
                                                                        class="mini-btn filled-gray"
                                                                        (click)="addFileDoc($event,group,i)">Upload</button>
                                                                </div>
                                                                <div class="value" *ngIf="group.get('file_name').value">
                                                                    <a class="text-ternary"
                                                                        style="word-break: break-all;"
                                                                        (click)="downloadDocDeclare(group,i)">
                                                                        {{group.get('original_file_name').value}}</a>
                                                                    <button type="button" mat-raised-button
                                                                        class="mini-btn filled-gray"
                                                                        (click)="removeDocDeclare(group,i)">Remove</button>
                                                                </div>
                                                            </div>

                                                            <div class="grid-list-form m-t-20">
                                                                <div class="property"></div>
                                                                <div class="value text-center">
                                                                    <a class="text-success"
                                                                        (click)="doneRow(group, i)">Save</a>
                                                                    <a class="text-danger m-l-10"
                                                                        (click)="cancelRow(group,i)">Cancel</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </mat-card>
                                        </mat-expansion-panel>
                                    </mat-accordion>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </form>
        </div>

    </mat-card-content>
</mat-card>


<mat-card class="billable-item-info m-b-20">
    <form [formGroup]="billable_item" (keydown.enter)="$event.target.tagName == 'TEXTAREA'">
        <mat-card-header>
            <div class="sub-title p-l-10 w-100 p-t-10 p-b-10">Billable Item - Intake Information<span
                    class="custom-info regulation" *ngIf="!isIME"
                    (click)="examinationDetails?.procedure_type == 'Deposition' ? openPopupRegulation(regulation?.regulationsForDepositionItemIntake?.title, regulation?.regulationsForDepositionItemIntake?.codes) : openPopupRegulation(regulation?.regulationsForBillableItemIntake?.title, regulation?.regulationsForBillableItemIntake?.codes)">
                    <i class="material-icons-outlined">info</i><sup>Regulations</sup></span></div>
            <span class="spacer"></span>
            <!-- *ngIf="!(isExamTypeChanged) || !(isFreeze)" -->
            <span>
                <!-- [disabled]="appointmentStatus || disableExaminationArr.includes(examinationDetails?.appointments?.examination_status) || isFreeze" -->
                <button type="button" class="filled-gray m-b-5" *ngIf="!isEditBillableItem" (click)="editBillable()"
                    mat-raised-button>Edit</button>
                <!-- [disabled]="appointmentStatus || disableExaminationArr.includes(examinationDetails?.appointments?.examination_status) || isFreeze" -->
                <button class="filled-success m-b-5" *ngIf="isEditBillableItem" (click)="submitBillableItem()"
                    mat-raised-button>Save</button>
            </span>
        </mat-card-header>
        <mat-divider> </mat-divider>
        <mat-card-content *ngIf="!isBillabbleItemLoading">
            <div fxLayout="row wrap" fxFlex="100" class="p-t-15">
                <div fxLayout="row wrap" fxFlex="100" class="p-t-15">
                    <div fxLayout="row wrap" fxFlex="100" formGroupName="exam_type">
                        <mat-form-field appearance="outline" fxFlex="100" fxFlex.md="100" fxFlex.sm="100"
                            fxFlex.xs="100">
                            <mat-label>Exam Procedure Type*</mat-label>
                            <mat-select formControlName="exam_procedure_type_id"
                                (selectionChange)="examTypeChange($event.value)">
                                <mat-option *ngFor="let procuderalCode of procuderalCodes"
                                    [value]="procuderalCode.exam_procedure_type_id"
                                    (click)="procedure_type(procuderalCode)">
                                    {{procuderalCode.exam_procedure_name}}
                                </mat-option>
                            </mat-select>
                            <mat-error>Please select Exam Procedure Type</mat-error>
                        </mat-form-field>
                    </div>
                    <div fxLayout="row wrap" fxFlex="100" formGroupName="appointment">
                        <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100">
                            <mat-label>Examiner*</mat-label>
                            <!-- <input matInput disabled> -->
                            <!-- <input matInput [value]="examinerName" placeholder="Examiner" maxlength="3"
                                autocomplete="off" [attr.disabled]="disabled ? '' : null"> -->
                            <mat-select formControlName="examiner_id">
                                <mat-option>
                                    <ngx-mat-select-search [formControl]="examinerFilterCtrl"
                                        placeholderLabel="Find Examiner" i18n-placeholderLabel
                                        noEntriesFoundLabel="No Matching Examiner Found" i18n-noEntriesFoundLabel>
                                    </ngx-mat-select-search>
                                </mat-option>
                                <mat-option *ngFor="let examinar of filteredExaminerList | async"
                                    (click)="examinarChange(examinar)" [value]="examinar.id">
                                    {{examinar.first_name}} {{examinar.middle_name}}
                                    {{examinar.last_name}}{{examinar.suffix ? (", "+ examinar.suffix) : ""}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>

                        <div fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100" class="past-date-and-time">
                            <div fxLayout="row wrap">
                                <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50"
                                    fxFlex.xs="100" *ngIf="!isSuplimental && !billable_item?.disabled">
                                    <mat-label>Date & Time</mat-label>
                                    <input matInput placeholder="MM-DD-YYYY HH:MM AM/PM"
                                        formControlName="appointment_scheduled_date_time"
                                        [value]="appointment_scheduled_date_time"
                                        (dateTimeChange)="changeDateType(billable_item?.value?.appointment?.appointment_scheduled_date_time)"
                                        autocomplete="off" [owlDateTime]="appointment" [min]="examinationDetails?.dob">
                                    <mat-datepicker-toggle matSuffix [owlDateTimeTrigger]="appointment"
                                        [disabled]="!isEditBillableItem || this.billable_item.get(['appointment', 'appointment_scheduled_date_time']).disabled">
                                    </mat-datepicker-toggle>
                                    <owl-date-time (afterPickerOpen)="pickerOpened('app')" [hour12Timer]="true"
                                        #appointment>
                                    </owl-date-time>
                                    <mat-error>Please enter valid date & time</mat-error>
                                </mat-form-field>

                                <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50"
                                    fxFlex.xs="100" *ngIf="!isSuplimental && billable_item?.disabled">
                                    <mat-label>Date & Time</mat-label>
                                    <input matInput placeholder="MM-DD-YYYY HH:MM AM/PM" [min]="todayDate.appointment"
                                        [value]="appointment_scheduled_date_time" disabled>
                                </mat-form-field>

                                <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50"
                                    fxFlex.xs="100" *ngIf="!isSuplimental" class="duration">
                                    <mat-label>Duration</mat-label>
                                    <input matInput type="number" placeholder="Minutes" min="1" max="450" maxlength="3"
                                        formControlName="duration" autocomplete="off">
                                    <span matSuffix>Minutes</span>
                                    <mat-error>Please enter a valid duration between 1 to 450 minutes</mat-error>
                                </mat-form-field>
                            </div>
                            <div fxLayout="row wrap" *ngIf="!isSuplimental">
                                <div fxFlex="100" class="note">
                                    <mat-icon>info</mat-icon>For past dates of service the appointment standing is
                                    automatically changed to “attended” and the billable item standing is changed to
                                    “Bill Report”
                                </div>
                            </div>
                        </div>

                        <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100"
                            *ngIf="!isSuplimental">
                            <mat-label>Location</mat-label>
                            <mat-select [disabled]="!isEditBillableItem"
                                (selectionChange)="serviceLocationChange($event.value)"
                                formControlName="examiner_service_location_id">
                                <mat-select-trigger>
                                    {{service_location_name == '0' ? "Virtual Service Location" : service_location_name
                                    }}
                                </mat-select-trigger>
                                <mat-option (click)="VserviceLocation()" value="0">
                                    Virtual Service Location
                                </mat-option>
                                <mat-option *ngFor="let address of examinarAddress"
                                    (click)="changeExaminarAddress(address)" [value]="address.address_id">
                                    {{address?.service_location_name}} - {{address.street1 ? address.street1 + ", " :
                                    ""}}{{address.street2 ? address.street2 + ", " : ""}}
                                    {{address.city ? address.city + ", " : ""}}{{address.state_code}} -
                                    {{address.zip_code+(address.zip_code_plus_4 != null ? "-"+address.zip_code_plus_4 :
                                    "")}}
                                </mat-option>
                            </mat-select>
                            <mat-error>Please select service location</mat-error>
                        </mat-form-field>
                        <div fxFlex="100" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50" fxFlex.sm="50" fxFlex.xs="100">

                        </div>
                        <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100"
                            *ngIf="billable_item?.value?.appointment?.is_virtual_location">
                            <mat-label>Conference URL</mat-label>
                            <input matInput placeholder="To be provided by the scheduling party"
                                formControlName="conference_url" autocomplete="off">
                            <mat-error>Please enter a valid Conference URL</mat-error>
                        </mat-form-field>

                        <div fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100"
                            *ngIf="billable_item?.value?.appointment?.is_virtual_location">

                            <mat-form-field appearance="outline" fxFlex="70" class="phone">
                                <mat-label>Conference Phone</mat-label>
                                <input matInput (keypress)="numberOnly($event)" mask="(000) 000-0000"
                                    placeholder="To be provided by the scheduling party"
                                    formControlName="conference_phone" autocomplete="off">
                                <mat-error>Please enter a valid Conference Phone</mat-error>
                            </mat-form-field>
                            <mat-form-field appearance="outline" fxFlex="30" class="phone-ext">
                                <mat-label>Ext</mat-label>
                                <input matInput type="text" placeholder="Ext" autocomplete="off"
                                    (keypress)="numberOnly($event)" formControlName="phone_ext">
                                <mat-error>Please enter valid Extension</mat-error>
                            </mat-form-field>

                        </div>

                    </div>
                    <div fxLayout="row wrap" fxFlex="100" formGroupName="intake_call">
                        <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100"
                            *ngIf="!isSuplimental">
                            <mat-label>Intake Caller</mat-label>
                            <input matInput placeholder="Intake Caller" formControlName="caller_name"
                                autocomplete="off">
                        </mat-form-field>
                        <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100">
                            <mat-label>Requesting Party</mat-label>
                            <mat-select formControlName="caller_affiliation">
                                <mat-option *ngFor="let caller of callerAffliation" [value]="caller.id">
                                    {{caller.agent_type_name}}</mat-option>
                            </mat-select>
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100">
                            <mat-label>Request Receipt Date{{isSuplimental ? '*' : ''}}</mat-label>
                            <!-- <input matInput placeholder="MM-DD-YYYY HH:MM AM/PM"
                                [value]="changeDateType(billable_item?.value?.intake_call?.call_date)"
                                formControlName="call_date" autocomplete="off" [min]="minDate" [max]="todayDate.intake"
                                [owlDateTime]="intake">
                            <mat-datepicker-toggle matSuffix [owlDateTimeTrigger]="intake"
                                [disabled]="!isEditBillableItem">
                            </mat-datepicker-toggle>
                            <owl-date-time (afterPickerOpen)="pickerOpened('intake')" [hour12Timer]="true" #intake>
                            </owl-date-time>
                            <mat-error>Please enter valid date & time</mat-error> -->

                            <input matInput placeholder="MM-DD-YYYY" autocomplete="off" [matDatepicker]="call_date"
                                [max]="todayDate.intake" formControlName="call_date" [min]="examinationDetails?.dob">
                            <mat-datepicker-toggle matSuffix [for]="call_date"></mat-datepicker-toggle>
                            <mat-datepicker #call_date [disabled]="!isEditBillableItem"></mat-datepicker>
                            <mat-error>Please enter valid date</mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100"
                            *ngIf="!isSuplimental">
                            <mat-label>Communication Type</mat-label>
                            <mat-select formControlName="call_type">
                                <mat-option *ngFor="let contactType of contactTypes" [value]="contactType.id">
                                    {{contactType.display_name}}</mat-option>
                            </mat-select>
                        </mat-form-field>

                        <div fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100" *ngIf="!isSuplimental">

                            <mat-form-field appearance="outline" fxFlex="70" class="phone">
                                <mat-label>Intake Contact Phone</mat-label>
                                <input matInput placeholder="Intake Contact Phone" formControlName="caller_phone"
                                    (keypress)="numberOnly($event)" mask="(000) 000-0000" autocomplete="off">
                                <mat-error>Please enter valid phone</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="30" class="phone-ext">
                                <mat-label>Ext</mat-label>
                                <input matInput type="text" placeholder="Ext" autocomplete="off"
                                    (keypress)="numberOnly($event)" formControlName="phone_ext">
                                <mat-error>Please enter valid Extension</mat-error>
                            </mat-form-field>

                        </div>

                        <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100"
                            *ngIf="!isSuplimental">
                            <mat-label>Intake Contact Fax</mat-label>
                            <input matInput placeholder="Intake Contact Fax" formControlName="caller_fax"
                                autocomplete="off" (keypress)="numberOnly($event)" mask="(000) 000-0000">
                            <mat-error>Please enter valid fax</mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100"
                            *ngIf="!isSuplimental">
                            <mat-label>Intake Contact Email</mat-label>
                            <input matInput placeholder="Intake Contact Email" formControlName="caller_email"
                                autocomplete="off">
                            <mat-error>Please enter valid email</mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="50" fxFlex.md="50" fxFlex.sm="50" fxFlex.xs="100"
                            *ngIf="!isSuplimental">
                            <mat-label>Intake Notes</mat-label>
                            <input matInput placeholder="Intake Notes" formControlName="notes" autocomplete="off">
                        </mat-form-field>
                    </div>
                    <section class="supplemental-type" fxLayout="row wrap" fxFlex="100"
                        *ngIf="isSuplimental && billable_item.get('documents_received')">
                        <div fxFlex="50" fxFlex.sm="50" fxFlex.xs="100" class="supplemental-custom-check">
                            <div class="m-b-10 label">Items Received</div>
                            <span formArrayName="documents_received"
                                *ngFor="let order of supplementalItems; let i = index">
                                <mat-checkbox class="m-r-10" [formControlName]="i" (click)="supplementalCheck()">
                                    {{supplementalItems[i]?.name}}</mat-checkbox>
                            </span>
                        </div>
                        <mat-form-field fxFlex="50" fxFlex.sm="50" fxFlex.xs="100" formGroupName="intake_call"
                            appearance="outline" fxFlex="50"
                            *ngIf="isSuplimental && billable_item.get('documents_received') && billable_item.get('documents_received').value[supplementalOtherIndex]">
                            <mat-label>Other description</mat-label>
                            <textarea matInput placeholder="Other description" formControlName="notes"
                                cdkTextareaAutosize cdkAutosizeMinRows="1" cdkAutosizeMaxRows="1"
                                autocomplete="off"></textarea>
                            <!-- <mat-error *ngIf="noteError">Please enter valid Other Description</mat-error> -->
                        </mat-form-field>
                    </section>
                    <div class="text-center w-100 m-t-10 m-b-10 action-button" *ngIf="isEditBillableItem">
                        <button mat-stroked-button type="button" class="m-r-10 outline-danger"
                            (click)="billableCancel()">Cancel</button>
                        <button mat-stroked-button class="m-r-10 outline-success" (click)="submitBillableItem()">
                            Save </button>
                    </div>
                </div>

            </div>
        </mat-card-content>
    </form>
</mat-card>

<mat-card class="document-info m-t-25" *ngIf="examinationDetails?.procedure_type != 'Cancellation'">
    <mat-card-header>
        <div class="sub-title p-l-10 w-100 p-t-10 p-b-10">Documents<span *ngIf="!isIME" class="custom-info regulation"
                (click)="openPopupRegulation(regulation?.regulationsForBillableItemDocuments?.title, regulation?.regulationsForBillableItemDocuments?.codes)"><i
                    class="material-icons-outlined">info</i><sup>Regulations</sup></span></div>
    </mat-card-header>
    <mat-divider> </mat-divider>
    <mat-card-content>
        <div fxLayout="row wrap">
            <div fxLayout="row wrap" *ngIf="!(isExamTypeChanged) || !(isFreeze)" fxFlex="100"
                class="document-file-upload w-100">
                <mat-form-field fxFlex="100" fxFlex.sm="100" fxFlex.md="30" fxFlex.lg="30" fxFlex.xl="30"
                    appearance="outline" class="p-l-0 m-t-2">
                    <mat-label>Document Type</mat-label>
                    <mat-select [(ngModel)]="documentType" (selectionChange)="docChange($event.value)">
                        <mat-option *ngFor="let doc of documentList" [value]="doc.id">
                            {{doc.document_category_name }}
                        </mat-option>
                    </mat-select>
                    <mat-hint *ngIf="errors.doc_type.isError">
                        <mat-error>
                            {{errors.doc_type.error}}
                        </mat-error>
                    </mat-hint>
                </mat-form-field>
                <div fxFlex="100" fxFlex.sm="100" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50" class="Upload_"
                    *ngIf="documentType == null || (documentType != 6 && documentType != 12 && documentType != 9)">
                    <!-- <button type="button" mat-stroked-button class="filled-gray"
                        (click)="openUploadPopUp(false,['.pdf', '.doc', '.docx'], '', '',  30)">Select
                        File
                    </button> -->
                    <!-- <mat-form-field appearance="standard"> -->
                    <button type="button" mat-stroked-button class="filled-ternary"
                        (click)="openUploadPopUp(true,['.pdf', '.doc', '.docx'], '', '',  3073)">Upload File</button>
                    <!-- <mat-form-field appearance="standard">
                        <input matInput [(ngModel)]="file" readonly placeholder="No file chosen">
                        <input type="file" #uploader hidden (change)="addFile($event)" hidden accept=".pdf, .doc, .docx"
                            required>
                        <mat-hint>Supported file formats: .pdf, .doc, .docx</mat-hint>
                        <mat-hint *ngIf="errors.file.isError">
                            <mat-error>{{errors.file.error}}</mat-error>
                        </mat-hint>
                    </mat-form-field> -->
                </div>

                <div fxFlex="100" fxFlex.sm="100" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50" class="Upload_"
                    *ngIf="documentType == 6">
                    <!-- <button mat-raised-button class="filled-gray"
                        (click)="openUploadPopUp(true,['.pdf', '.doc', '.docx'], '', '6',  30)">Select File</button> -->
                    <!-- <mat-form-field appearance="standard" class="p-l-10 w-100  custom-br"> -->
                    <button mat-raised-button class="filled-ternary"
                        (click)="openUploadPopUp(true,['.pdf', '.doc', '.docx', '.mp3', '.wav', '.m4a', '.wma', '.dss', '.ds2', '.dct'], '', '6',  3073)">Upload
                        File</button>
                    <!-- <mat-form-field appearance="standard" class="p-l-10 w-100  custom-br">
                        <input matInput value="{{file | ellipsis:50}}" readonly placeholder="No file chosen">
                         <input type="file" #uploader hidden (change)="addFile($event)" multiple
                            accept=".pdf, .doc, .docx, .mp3, .wav, .m4a, .wma, .dss, .ds2, .dct" required> 
                        <mat-hint>Supported file formats: .pdf, .doc, .docx, .mp3, .wav, .m4a, .wma, .dss, .ds2, .dct
                        </mat-hint>
                        <mat-hint *ngIf="errors.file.isError">
                            <mat-error>{{errors.file.error}}</mat-error>
                        </mat-hint>
                    </mat-form-field> -->
                </div>

                <div fxFlex="100" fxFlex.sm="100" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50" class="Upload_"
                    *ngIf="documentType == 9">
                    <button mat-raised-button class="filled-ternary"
                        (click)="openUploadPopUp(true,['.pdf', '.doc', '.docx'], '', '6',  30)">Upload
                        File</button>
                </div>
                <div fxFlex="100" fxFlex.sm="100" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50" class="Upload_"
                    *ngIf="documentType == 12">
                    <button mat-raised-button class="filled-ternary"
                        (click)="openUploadPopUp(false,['.pdf', '.doc', '.docx'], '', '6',  30)">Upload
                        File</button>
                </div>


                <!-- <div fxFlex="100" fxFlex.sm="100" fxFlex.md="20" fxFlex.lg="20" fxFlex.xl="20">
                    <button mat-stroked-button type="button" (click)="uploadFile()" class="filled-gray p-r-20">Add
                    </button>
                </div> -->

            </div>
            <!-- <div fxLayout="row wrap" *ngIf="isExamTypeChanged" fxFlex="100" class="document-file-upload w-100">
               
            </div> -->

            <!-- <div *ngIf="!isExamTypeChanged && !billableData?.isExaminerDisabled && userEmail.includes('auriss.com') && !isFreeze"
                fxLayout="row wrap" fxFlex="100" class="m-t-20">
                <div fxFlex="100" fxFlex.sm="100" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="50">
                </div>

                <mat-form-field fxFlex="100" fxFlex.sm="100" fxFlex.md="30" fxFlex.lg="30" fxFlex.xl="30"
                    appearance="outline" class="generate-doc">
                    <mat-label>Generate Document</mat-label>
                    <mat-select [(ngModel)]="formId" placeholder="Select Form">
                        <mat-option *ngFor="let form of forms" [value]="form.value">
                            {{form.name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <div fxFlex="100" fxFlex.sm="100" fxFlex.md="20" fxFlex.lg="20" fxFlex.xl="20">
                    <button mat-stroked-button type="button" (click)="generateForm()"
                        class="filled-gray p-r-20 m-t-20">Generate
                    </button>
                </div>
            </div> -->
            <div fxLayout="row wrap" fxFlex="100" class="p-t-15">
                <mat-tab-group fxFlex="100" (selectedTabChange)="tabChanges($event)">
                    <mat-tab *ngFor="let doc of procedureTypeList" label="{{doc.name}}"></mat-tab>
                </mat-tab-group>
                <div class="table-filter">
                    <input matInput (keyup)="applyFilter($event.target.value)" [(ngModel)]="filterValue"
                        placeholder="Search by file name, date" autocomplete="off">
                    <mat-icon>search</mat-icon>
                </div>

                <div class="user-detail  vertical-fixed">
                    <table mat-table [dataSource]="documentsData" multiTemplateDataRows
                        class="mat-elevation-z8 user-table" matSort #docSort="matSort">
                        <ng-container matColumnDef="{{column}}"
                            *ngFor="let column of displayedColumnsForDocuments; let i=index">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header
                                [disabled]="columnName[i] == 'Action'">{{columnName[i]}}</th>
                            <td mat-cell *matCellDef="let element">
                                <span *ngIf="i == 0 && isMobile">
                                    <mat-icon mat-raised-button
                                        [ngClass]="{'table-expand': expandId == element.id, 'expand-close': !(expandId == element.id)}">
                                        {{ expandId == element.id ? 'remove_circle' : 'add_circle'}}
                                    </mat-icon>
                                </span>
                                <div>
                                    <span *ngIf="column == 'doc_image'" class="file_type_icon"><img
                                            [src]="element?.file_name | fileType" alt=""></span>
                                    <span *ngIf="column == 'file_name'"> <a target="_self" class="text-info">
                                            {{ element?.original_file_name && element?.original_file_name != '' ?
                                            element?.original_file_name : element?.file_name }}</a> </span>
                                    <span *ngIf="column == 'updatedAt'">{{element?.updatedAt | date:'MM-dd-yyyy hh:mm
                                        a'}}</span>
                                    <span *ngIf="column == 'pfs' && element?.proof_of_service_file_name">
                                        <a target="_self" class="text-success"
                                            (click)="$event.stopPropagation();download({exam_report_file_url : element?.proof_of_service_file_url, file_name : element?.proof_of_service_file_name})">Download</a>
                                    </span>
                                    <span *ngIf="column == 'type'" class="no-wrap-td" [ngSwitch]="element?.action">
                                        <span *ngSwitchCase="'BD'">Downloaded</span>
                                        <span *ngSwitchCase="'MES'">E-Sign Downloaded</span>
                                        <span *ngSwitchCase="'SFTP'"><span *ngIf="!element?.isdtm_request">Billed On
                                                Demand</span>
                                            <span *ngIf="element?.isdtm_request">Mailed On Demand</span></span>
                                    </span>
                                    <span *ngIf="column == 'bill_submission_type'">
                                        {{element?.bill_submission_type ? element?.bill_submission_type : 'First'}}
                                    </span>
                                    <span *ngIf="column == 'send'">
                                        <a class="text-success"
                                            (click)="$event.stopPropagation();downloadDocumetSend(element?.send)">Download</a>
                                    </span>
                                    <span *ngIf="column == 'action' && !element?.proof_of_service_file_name"
                                        class="text-center no-wrap-td">
                                        <a target="_self" class="text-success"
                                            (click)="$event.stopPropagation();downloadDocumet(element)">Download</a>
                                        <!-- <a class="text-ternary m-l-10"
                                            (click)="$event.stopPropagation();openPDF(element)">View</a> -->
                                        <a class="text-danger m-l-10"
                                            *ngIf="!element?.isServiceRequested && !isExamTypeChanged && !billableData?.isExaminerDisabled && !isFreeze"
                                            (click)="$event.stopPropagation();deleteDocument(element)">Remove</a>
                                    </span>
                                </div>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="expandedDetail">
                            <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumnsForDocuments.length">
                                <div class="detail"
                                    [@detailExpand]="expandId == (element?.id ? element.id : element?.document_id) ? 'expanded' : 'collapsed'">
                                    <div class="responsive-table">
                                        <div *ngIf="this.tabIndexDetails.index == 1"><span>Download On Demand Proof of
                                                Service</span>
                                            <span>
                                                <a target="_self" class="text-success"
                                                    (click)="$event.stopPropagation();download({exam_report_file_url : element?.proof_of_service_file_url, file_name : element?.proof_of_service_file_name})">Download</a>
                                            </span>
                                        </div>
                                        <div><span>Uploaded on</span><span>
                                                {{element.updatedAt | date:'MM-dd-yyyy hh:mm a'}} </span></div>
                                        <div><span>Action</span><span>
                                                <a target="_self" class="text-success"
                                                    (click)="$event.stopPropagation();downloadDocumet(element)">Download</a>
                                                <a class="text-danger m-l-10"
                                                    *ngIf="!element?.isServiceRequested && !isExamTypeChanged && !billableData?.isExaminerDisabled && !isFreeze"
                                                    (click)="$event.stopPropagation();deleteDocument(element)">Remove</a>
                                            </span></div>
                                    </div>
                                </div>
                            </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="displayedColumnsForDocuments; sticky: true"></tr>
                        <tr mat-row *matRowDef="let element; columns: displayedColumnsForDocuments;" class="row"
                            [class.row]="expandedElement === element" (click)="openElement(element)">
                        </tr>
                        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
                    </table>
                    <app-nodata *ngIf="documentsData?.filteredData?.length == 0"></app-nodata>
                </div>
            </div>
        </div>
    </mat-card-content>
</mat-card>

<mat-card class="notes-info m-t-25">
    <mat-card-header>
        <div class="sub-title p-l-10 w-100 p-t-10 p-b-10">Notes</div>
        <!-- <span class="spacer"></span>
        <span *ngIf="!isExamTypeChanged && !billableData?.isExaminerDisabled">
            <button class="filled-gray m-b-5" *ngIf="!isNotesEdit" (click)="notesEdit()" mat-raised-button>Edit</button>
            <button class="filled-success m-b-5" *ngIf="isNotesEdit" (click)="noteSubmit()"
                mat-raised-button>Save</button>
        </span> -->
    </mat-card-header>
    <mat-divider> </mat-divider>
    <mat-card-content>
        <form [formGroup]="notesForm">
            <div fxLayout="row wrap" fxFlex="100" class="p-t-15">
                <mat-form-field appearance="outline">
                    <!-- <input matInput type="text" autocomplete="off" placeholder="Notes" [ngModelOptions]="{standalone: true}" [(ngModel)]="notes"> -->
                    <textarea matInput placeholder="Notes" cdkTextareaAutosize cdkAutosizeMinRows="1"
                        formControlName="notes" cdkAutosizeMaxRows="1" autocomplete="off"
                        [(ngModel)]="notes"></textarea>
                    <mat-error *ngIf="noteError">Please enter valid Notes</mat-error>
                </mat-form-field>
                <button mat-stroked-button class="m-r-10 outline-success" (click)="notesSubmit(notes)">Add
                    Notes</button>
                <!-- <mat-form-field appearance="outline" fxFlex="100">
                        <textarea matInput formControlName="exam_notes" placeholder="Notes" cdkTextareaAutosize
                            cdkAutosizeMinRows="1" cdkAutosizeMaxRows="1"></textarea>
                    </mat-form-field> -->
                <!-- <div class="text-center w-100 m-t-10 m-b-10 action-button" *ngIf="isNotesEdit">
                    <button mat-stroked-button type="button" class="m-r-10 outline-danger"
                        (click)="noteCancel()">Cancel</button>
                    <button mat-stroked-button class="m-r-10 outline-success" (click)="noteSubmit()">
                        Save </button>
                </div> -->
            </div>

        </form>
        <div class="table-filter">
            <input matInput autocomplete="off" (keyup)="applyNotesFilter($event.target.value)"
                [(ngModel)]="noteFilterValue" placeholder="Search by notes, date created, user">
            <mat-icon>search</mat-icon>
        </div>
        <div class="user-detail default-cursor">
            <table mat-table [dataSource]="notesDataSource" multiTemplateDataRows class="mat-elevation-z8 user-table"
                matSort #MatSortNote="matSort">
                <ng-container matColumnDef="{{column}}" *ngFor="let column of columnsToDisplays; let i=index">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="notecolumnName[i] == 'Action'">
                        {{notecolumnName[i]}}</th>
                    <td mat-cell *matCellDef="let element;let m">
                        <span *ngIf="i == 0 && isMobile">
                            <mat-icon mat-raised-button
                                [ngClass]="{'table-expand': expandIdnote == m, 'expand-close': !(expandIdnote == m)}">
                                {{ expandIdnote == m ? 'remove_circle' : 'add_circle'}}
                            </mat-icon>
                        </span>
                        <div>
                            <!-- <span *ngIf="column == 'task'">{{element?.task}}</span> -->
                            <span *ngIf="column == 'notes'">{{element?.notes}}</span>
                            <span *ngIf="column == 'createdAt'">{{element?.createdAt | date:'MM-dd-yyyy h:mm a'}}</span>
                            <span *ngIf="column == 'name'">{{element?.user?.first_name}}
                                {{element?.user?.last_name}}{{element?.user?.suffix ? ', ' + element?.user?.suffix :
                                ''}}</span>
                        </div>
                    </td>
                </ng-container>
                <ng-container matColumnDef="expandedDetail">
                    <td mat-cell *matCellDef="let element;let n" [attr.colspan]="columnsToDisplays.length">
                        <div class="detail" [@detailExpand]="expandIdnote == n ? 'expanded' : 'collapsed'">
                            <div class="responsive-table">
                                <div><span>Notes</span>{{element?.notes}}</div>
                                <div><span>Date Created</span>{{element?.createdAt | date:'MM-dd-yyyy h:mm a'}}</div>
                                <div><span>user</span>{{element?.user?.first_name}}
                                    {{element?.user?.last_name}}{{element?.user?.suffix ? ', ' + element?.user?.suffix :
                                    ''}}</div>
                            </div>
                        </div>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="columnsToDisplays"></tr>
                <tr mat-row *matRowDef="let element; columns: columnsToDisplays; let j" class="row"
                    [class.row]="expandedElement === element" (click)="openElement2(j)">
                </tr>
                <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
            </table>
            <app-nodata *ngIf="notesDataSource?.filteredData?.length == 0"></app-nodata>
        </div>

        <mat-paginator #MatPaginatorNote="matPaginator" [pageSizeOptions]="[10, 25, 100]"></mat-paginator>
    </mat-card-content>
</mat-card>
<!-- 
<mat-card class="notes-info m-t-25">
    <mat-card-header>
        <div class="sub-title p-l-10 w-100 p-t-10 p-b-10">Notes</div>
        <span class="spacer"></span>
        <span *ngIf="!isExamTypeChanged && !billableData?.isExaminerDisabled">
            <button class="filled-gray m-b-5" *ngIf="!isNotesEdit" (click)="notesEdit()" mat-raised-button>Edit</button>
            <button class="filled-success m-b-5" *ngIf="isNotesEdit" (click)="noteSubmit()"
                mat-raised-button>Save</button>
        </span>
    </mat-card-header>
    <mat-divider> </mat-divider>
    <mat-card-content>
        <form [formGroup]="notesForm">
            <div fxLayout="row wrap" fxFlex="100" class="p-t-15">
                <mat-form-field appearance="outline" fxFlex="100">
                    <textarea matInput formControlName="exam_notes" placeholder="Notes" cdkTextareaAutosize
                        cdkAutosizeMinRows="5" cdkAutosizeMaxRows="5"></textarea>
                </mat-form-field>
                <div class="text-center w-100 m-t-10 m-b-10 action-button" *ngIf="isNotesEdit">
                    <button mat-stroked-button type="button" class="m-r-10 outline-danger"
                        (click)="noteCancel()">Cancel</button>
                    <button mat-stroked-button class="m-r-10 outline-success" (click)="noteSubmit()">
                        Save </button>
                </div>
            </div>

        </form>
    </mat-card-content>
</mat-card> -->

<mat-card class="activity-log m-t-25">
    <mat-card-header>
        <div class="sub-title p-l-10 w-100 p-t-10 p-b-10">Action Log</div>
    </mat-card-header>
    <mat-divider> </mat-divider>
    <mat-card-content>
        <div class="table-filter">
            <input matInput autocomplete="off" (keyup)="applyActivityFilter($event.target.value)"
                [(ngModel)]="activityFilterValue"
                placeholder="Search by action, created by, created at, updated by & updated at">
            <mat-icon>search</mat-icon>
        </div>
        <div class="user-detail default-cursor m-t-10">
            <table mat-table [dataSource]="activityLog" multiTemplateDataRows class="mat-elevation-z8 user-table"
                matSort #MatSortActivity="matSort">
                <ng-container matColumnDef="{{column}}"
                    *ngFor="let column of activityDisplayedColumnsForDocuments; let i=index">
                    <th mat-header-cell *matHeaderCellDef> <span mat-sort-header
                            [disabled]="activityColumnName[i] == ''">{{activityColumnName[i]}}</span></th>
                    <td mat-cell *matCellDef="let element">
                        <span *ngIf="i == 0 && isMobile">
                            <mat-icon mat-raised-button
                                [ngClass]="{'table-expand': actionLogexpandId == element.id, 'expand-close': !(actionLogexpandId == element.id)}">
                                {{ actionLogexpandId == element.id ? 'remove_circle' : 'add_circle'}}
                            </mat-icon>
                        </span>
                        <div>
                            <span *ngIf="column == 'module'">{{element?.module}}</span>
                            <span *ngIf="column == 'action_details'">{{element?.action_details}}</span>
                            <span *ngIf="column == 'created_by'">{{element?.created_by}}</span>
                            <span *ngIf="column == 'createdAt'">{{element?.createdAt == "-" ? element?.createdAt :
                                (element?.createdAt |
                                date:'MM-dd-yyyy h:mm a')}}</span>
                            <span *ngIf="column == 'updated_by'">{{(element?.updated_by?.first_name ?
                                element?.updated_by?.first_name : "") + " "
                                +(element?.updated_by?.last_name ? element?.updated_by?.last_name :
                                "")+(element?.updated_by?.suffix ?(", "+element?.updated_by?.suffix) : "" )}}</span>
                            <span *ngIf="column == 'updatedAt'">{{element?.updatedAt == "-" ? element?.updatedAt :
                                (element?.updatedAt |
                                date:'MM-dd-yyyy h:mm a')}}</span>
                        </div>
                    </td>
                </ng-container>
                <ng-container matColumnDef="expandedDetail">
                    <td mat-cell *matCellDef="let element" [attr.colspan]="activityDisplayedColumnsForDocuments.length">
                        <div class="detail"
                            [@detailExpand]="actionLogexpandId == element.id ? 'expanded' : 'collapsed'">
                            <div class="responsive-table">
                                <div><span>Type</span>{{element?.module}} </div>
                                <div><span>Created By</span>{{element?.created_by}}</div>
                                <div><span>Created At</span>{{element?.createdAt == "-" ? element?.createdAt :
                                    (element?.createdAt |
                                    date:'MM-dd-yyyy h:mm a')}}</div>
                                <div><span>Updated By</span>{{(element?.updated_by?.first_name ?
                                    element?.updated_by?.first_name : "") + " "
                                    +(element?.updated_by?.last_name ? element?.updated_by?.last_name :
                                    "")+(element?.updated_by?.suffix ?(", "+element?.updated_by?.suffix) : "" )}}</div>
                                <div><span>Updated At</span>{{element?.updatedAt == "-" ? element?.updatedAt :
                                    (element?.updatedAt |
                                    date:'MM-dd-yyyy h:mm a')}} </div>
                            </div>
                        </div>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="activityDisplayedColumnsForDocuments; sticky: true"></tr>
                <tr mat-row *matRowDef="let element; columns: activityDisplayedColumnsForDocuments;" class="row"
                    [class.row]="expandedElement === element" (click)="openElement1(element)">
                </tr>
                <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
            </table>
            <app-nodata *ngIf="activityLog?.filteredData?.length == 0"></app-nodata>
        </div>
        <mat-paginator #MatPaginatorActivity="matPaginator" [pageSizeOptions]="[10, 20, 50]"></mat-paginator>
    </mat-card-content>
</mat-card>