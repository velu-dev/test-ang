<div class="billing">

    <mat-tab-group class="m-t-10">
        <mat-tab label="First Bill Submission">
            <!-- ===== First Bill Submission ===== -->
        </mat-tab>
        <mat-tab label="Second Bill Review" disabled>
            <!-- ===== Second Bill Review ===== -->
        </mat-tab>
        <mat-tab label="Independent Bill Review" disabled>
            <!-- ===== Independent Bill Submission ===== -->
        </mat-tab>
    </mat-tab-group>

    <!-- ===== Bill Status ==== -->
    <div fxLayout="row wrap" class="p-t-20">
        <div fxFlex="100" fxFlex.sm="100" fxFlex.xs="100" class="bill-status">
            <div class="progress">
                <div class="main-title p-l-0">Bill Status</div>
                <p class="description p-l-0">View the Billâ€™s progress here, from beginning to end.</p>
                <mat-progress-bar mode="determinate" value="50" class="progress-status">
                </mat-progress-bar>
                <div class="text-center">{{billingData?.on_demand_progress_status}}</div>
            </div>
            <div class="review-status">
                <div>First Bill Review</div>
            </div>
        </div>
    </div>
    <div fxLayout="row wrap" class="p-t-20">
        <div fxFlex="50">
            <div class="bill-id"><span>Bill : </span> {{billingData?.agent_short_code}}{{billingData?.bill_no}}</div>
        </div>
        <div fxFlex="50">
            <div class="submission-date"><span>First Bill Review Submission Date :
                </span>{{billingData?.bill_first_submission_date ? (billingData?.bill_first_submission_date |
                date:'MM-dd-yyyy') : billingData?.on_demand_progress_status}}</div>
        </div>
    </div>

    <div class="border-dashed-blue"></div>

    <!-- ===== incomplete information ==== -->
    <div class="incomplete-info" *ngIf="!isIncompleteError">
        <mat-card>
            <mat-card-header>
                <div class="content-wrapper-main-title text-danger">Incomplete Information
                    <button mat-raised-button class="filled-gray m-b-5" (click)="isExpandDetail = !isExpandDetail">
                        {{isExpandDetail ? "Collapse" : "Expand"}} <i class="p-l-5 fas"
                            [ngClass]="{'fa-angle-up': isExpandDetail,'fa-angle-down': !isExpandDetail}"></i>
                    </button>
                </div>
            </mat-card-header>
            <mat-divider class="border-red"></mat-divider>
            <mat-card-content>
                <div fxLayout="row wrap" class="m-t-10">
                    <div fxFlex="100" class="incomplete-modules">
                        <div fxLayout="row wrap">
                            <div *ngFor="let incompleteInfo of incompleteInformation" fxFlex="50" fxFlex.xs="100"
                                fxFlex.sm="100">
                                <span class="text-danger">
                                    <mat-icon> error</mat-icon> {{incompleteInfo.name}}
                                </span>
                                <div class="incomplete-details"
                                    *ngIf="isExpandDetail && incompleteInfo?.value?.length > 0">
                                    <ol>
                                        <li *ngFor="let val of incompleteInfo.value">{{val}}</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>

    <div class="incomplete-info" *ngIf="payerResponse.length">
        <mat-card>
            <mat-card-header>
                <div class="content-wrapper-main-title text-danger m-t-10 m-b-10">Claims Administrator Feedback</div>
            </mat-card-header>
            <mat-divider class="border-red"></mat-divider>
            <mat-card-content>
                <div fxLayout="row wrap" class="p-t-10">
                    <div class="incomplete-modules" fxFlex="100">
                        <ul>
                            <li *ngFor="let payer of payerResponse" class="text-danger">
                                <mat-icon>error</mat-icon>{{payer?.status_date | date:'MM-dd-yyyy' }} -
                                {{payer?.MessageText}}
                            </li>
                        </ul>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>

    <!-- ===== Examiner information ==== -->
    <div class="examiner-info">
        <mat-card>
            <mat-card-header>
                <div class="content-wrapper-main-title">Provider Information</div>
            </mat-card-header>
            <mat-divider></mat-divider>
            <mat-card-content>
                <div fxLayout="row wrap" class="p-t-20">
                    <div fxFlex="33.3" fxFlex.xs="100">
                        <div class="p-b-5"><b>Billing Provider</b></div>
                        <div *ngIf="billingData?.billing_is_person"> {{billingData?.billing_last_name}}
                            {{billingData?.billing_first_name}}{{billingData?.billing_suffix ? (', '+
                            billingData?.billing_suffix) : ''}}
                        </div>
                        <div *ngIf="!billingData?.billing_is_person">{{billingData?.billing_provider_name}}</div>
                    </div>
                    <div fxFlex="33.3" fxFlex.xs="100">
                        <div class="p-b-5"><b>Rendering Provider</b></div>
                        <div *ngIf="billingData?.rendering_is_persion">{{billingData?.rendr_last_name}}
                            {{billingData?.rendr_first_name}}{{billingData?.rendr_suffix ? (', '+
                            billingData?.rendr_suffix) : ''}}
                        </div>
                        <div *ngIf="!billingData?.rendering_is_persion">{{billingData?.rendering_provider_name}}</div>
                    </div>
                    <div fxFlex="33.3" fxFlex.xs="100" *ngIf="billingData?.procedure_type != 'Supplemental'">
                        <div class="p-b-5"><b>Service Location</b> </div>
                        <div *ngIf="!billingData?.is_virtual_location">{{billingData?.service_location_name ?
                            billingData?.service_location_name + ' - ' : ''}}{{billingData?.service_location?.street1 }}
                            {{billingData?.service_location?.street2 }}
                            {{billingData?.service_location?.city}}
                            {{billingData?.state_code }}
                            {{billingData?.service_location?.zip_code ? '- ' + billingData?.service_location?.zip_code :
                            '' }}
                        </div>
                        <div *ngIf="billingData?.is_virtual_location">Virtual Service Location</div>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
    <!-- ===== Diagnosis Codes ==== -->
    <app-diagnosis-code *ngIf="billingData" [paramsId]="paramsId" [billingData]="billingData" [isMobile]="isMobile">
    </app-diagnosis-code>

    <!-- ===== Bill Items ==== -->

    <app-bill-line-item *ngIf="billingData" [paramsId]="paramsId" [billingData]="billingData" [isMobile]="isMobile">
    </app-bill-line-item>


    <!-- ===== Payment Response ==== -->
    <app-payment-response *ngIf="billingData" [paramsId]="paramsId" [billingData]="billingData"></app-payment-response>

    <!-- ===== Examination Submission Documents ==== -->
    <div fxlayout="row wrap" class="m-t-30 submission-document">
        <mat-card>
            <mat-card-header fxLayout="row wrap">
                <div class="content-wrapper-main-title" fxFlex="50">{{billDocumentList?.exam_procedure_name}}
                    Examination Submission Documents
                    <span class="info ondemand-info m-l-10"
                        matTooltip="The QME 122 - Declaration of service form will be created when the Report Documents are Downloaded or Billed on Demand."
                        matTooltipPosition="above"> <i class="fa fa-info" aria-hidden="true"></i></span>
                </div>
                <div class="content-wrapper-main-title bill-status" fxFlex="50">First Bill Submission</div>
            </mat-card-header>
            <mat-divider></mat-divider>
            <mat-card-content>
                <div fxLayout="row wrap">
                    <div fxFlex="100">See <span>these directions</span> provided by the state of California.</div>
                    <div fxFlex="100">Complete the following documents by downloading them, filling them and uploading
                        them below:
                    </div>
                    <div>
                        <ul *ngFor="let doc of this.billDocumentList?.document_info">
                            <li> {{doc}}</li>
                        </ul>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
    <!-- ===== Documents ==== -->
    <div class="documents">
        <mat-card>
            <mat-card-header>
            </mat-card-header>
            <mat-card-content>
                <div class="info-alert m-t-20">
                    <i class="fa fa-info-circle p-r-5"></i>Uploaded documents should not exceed 300 dpi
                </div>
                <div fxLayout="row wrap" class="w-100">
                    <div fxFlex="70" fxFlex.sm="100" fxFlex.xs="100" class="note">
                        <mat-icon>info</mat-icon> Note : Supported file formats: .pdf, .doc, .docx
                    </div>
                    <div fxFlex="30" fxFlex.sm="100" fxFlex.xs="100">
                        <input type="file" #uploader hidden (change)="addFile($event,true)" multiple
                            accept=".pdf, .doc, .docx" required>
                        <button mat-raised-button class="float-right filled-gray m-r-5 m-b-5"
                            (click)="uploader.click()"><i class="fa fa-file-medical p-r-10"></i> Add Custom
                            Document</button>
                    </div>
                    <div class="user-detail vertical-fixed default-cursor" fxFlex="100">
                        <table mat-table [dataSource]="documentsData" multiTemplateDataRows
                            class="mat-elevation-z8 user-table">
                            <ng-container matColumnDef="{{column}}"
                                *ngFor="let column of columnsToDisplay2; let i=index">
                                <th mat-header-cell *matHeaderCellDef>{{columnName2[i]}} </th>
                                <td mat-cell *matCellDef="let element;let j">
                                    <span *ngIf="i == 0 && isMobile">
                                        <mat-icon mat-raised-button
                                            [ngClass]="{'table-expand': expandId2 == j, 'expand-close': !(expandId2 == j)}">
                                            {{ expandId2 == j ? 'remove_circle' : 'add_circle'}}
                                        </mat-icon>
                                    </span>
                                    <div> <span *ngIf="column == 'doc_image'" class="file_type_icon">
                                            <!-- <img [src]="element?.file_name | fileType" alt=""> -->
                                        </span>
                                        <span *ngIf="column == 'file_name'">{{element?.form_name}}</span>
                                        <span *ngIf="column == 'partial'">

                                            <a class="text-ternary m-r-10"
                                                (click)="getGenerateBillingForm(element?.partial_document?.id)"
                                                *ngIf="element?.partial_document">Generate & Download
                                                <i class="fas fa-download"></i></a>
                                        </span>
                                        <span *ngIf="column == 'complete'">
                                            <a class="text-ternary m-r-10"
                                                (click)="element?.completed_document?.isCompleteOnly ? getGenerateBillingForm(element?.completed_document?.id) : download(element?.completed_document)"
                                                *ngIf="element?.completed_document">{{element?.completed_document?.isCompleteOnly
                                                ? 'Generate & Download' : element?.completed_document?.file_name}}
                                                <i class="fas fa-download"></i></a>

                                            <a *ngIf="!element?.completed_document && element?.form_action_type != 'C' && element?.form_action_type != 'X'"
                                                class="m-r-10 no-wrap-td" (click)="uploader.click()">
                                                Upload Completed Form
                                                <i class="fa fa-upload m-b-3"></i>
                                            </a>
                                            <input type="file" #uploader hidden
                                                (change)="addCompleteDoc($event,element)" hidden
                                                accept=".pdf, .doc, .docx" required>
                                        </span>
                                        <span *ngIf="column == 'document_type'">{{element?.document_type |
                                            titlecase}}</span>
                                        <span *ngIf="column == 'updatedAt'">{{element?.updatedAt | date:'MM-dd-yyyy
                                            hh:mm a'}}</span>
                                        <span *ngIf="column == 'action'">
                                            <input type="file" #uploader hidden
                                                (change)="addCompleteDoc($event,element)" hidden
                                                accept=".pdf, .doc, .docx" required>
                                            <a *ngIf="element?.form_action_type != 'C' && element?.form_action_type != 'X'"
                                                class="text-danger no-wrap-td"
                                                (click)=" element?.completed_document ? uploader.click() : ''">Remove
                                                and Reupload
                                            </a>
                                            <a *ngIf="element?.form_name == 'Custom'" class="text-danger no-wrap-td"
                                                (click)="deleteDocument(element?.completed_document,true)">Remove
                                            </a>
                                        </span>
                                    </div>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="expandedDetail">
                                <td mat-cell *matCellDef="let element;let k = index"
                                    [attr.colspan]="columnsToDisplay2.length">
                                    <div class="detail" [@detailExpand]="expandId2 == k ? 'expanded' : 'collapsed'">
                                        <div class="responsive-table">
                                            <div>
                                                <span>File Name</span>
                                                <span> {{element?.form_name}} </span>
                                            </div>
                                            <div>
                                                <span>Download Partial Document</span>
                                                <span> <a class="text-ternary m-r-10"
                                                        (click)="getGenerateBillingForm(element?.partial_document?.id)"
                                                        *ngIf="element?.partial_document">Generate & Download
                                                        <i class="fas fa-download"></i></a></span>
                                            </div>
                                            <div>
                                                <span>Complete</span>
                                                <span> <a class="text-ternary m-r-10"
                                                        (click)="element?.completed_document?.isCompleteOnly ? getGenerateBillingForm(element?.completed_document?.id) : download(element?.completed_document)"
                                                        *ngIf="element?.completed_document">{{element?.completed_document?.isCompleteOnly
                                                        ? 'Generate & Download' :
                                                        element?.completed_document?.file_name}}
                                                        <i class="fas fa-download"></i></a>

                                                    <a *ngIf="!element?.completed_document && element?.form_action_type != 'C' && element?.form_action_type != 'X'"
                                                        class="m-r-10 no-wrap-td" (click)="uploader.click()">
                                                        Upload Completed Form
                                                        <i class="fa fa-upload m-b-3"></i>
                                                    </a>
                                                    <input type="file" #uploader hidden
                                                        (change)="addCompleteDoc($event,element)" hidden
                                                        accept=".pdf, .doc, .docx" required></span>
                                            </div>
                                            <div>
                                                <span>Action</span>
                                                <span> <input type="file" #uploader hidden
                                                        (change)="addCompleteDoc($event,element)" hidden
                                                        accept=".pdf, .doc, .docx" required>
                                                    <a *ngIf="element?.form_action_type != 'C' && element?.form_action_type != 'X'"
                                                        class="text-danger no-wrap-td"
                                                        (click)=" element?.completed_document ? uploader.click() : ''">Remove
                                                        and Reupload
                                                    </a>
                                                    <a *ngIf="element?.form_name == 'Custom'"
                                                        class="text-danger no-wrap-td"
                                                        (click)="deleteDocument(element?.completed_document,true)">Remove
                                                    </a> </span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="columnsToDisplay2;sticky :true"></tr>
                            <tr mat-row *matRowDef="let element;let i = index; columns: columnsToDisplay2;" class="row"
                                [class.row]="expandedElement === element" (click)="openElementBill(i)">
                            </tr>
                            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
                        </table>
                        <app-nodata *ngIf="documentsData?.filteredData?.length == 0"></app-nodata>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>


    <div class="border-dashed-blue m-b-20 m-t-30"></div>

    <!-- ===== actions ==== -->
    <div class="ondamand-actions m-t-30 m-b-30" fxLayout="row wrap">
        <div fxFlex="33.3" fxFlex.sm="33.3" fxFlex.xs="100" class="align-left">
            <button mat-stroked-button class="filled-lightgray huge-btn m-b-5" (click)="VMC1500Submit()">View CMS
                1500</button>

        </div>
        <div fxFlex="33.3" fxFlex.sm="33.3" fxFlex.xs="100" class="align-center">
            <button mat-stroked-button class="filled-success huge-btn m-b-5" (click)="openBillOnDemand()">Submit Bill
                and Report</button>
        </div>
    </div>

    <div class="border-dashed-blue m-b-20 m-t-20"></div>

    <!-- ===== Billing Documents ==== -->
    <div class="completed-documents m-t-30">
        <app-billing-document *ngIf="billingData" [paramsId]="paramsId" [billingData]="billingData"
            [isMobile]="isMobile"></app-billing-document>
        <!-- <mat-card>
            <mat-card-content>
                <div fxLayout="row wrap" class="w-100">
                    <div fxFlex="100">
                        <div class="main-title p-l-0">Billing Documents</div>
                        <p class="description p-l-0">This table lists the documents, actions that were performed on the
                            documents, the date
                            that the actions were performed and the document recipients.</p>
                    </div>
                    <div class="user-detail vertical-fixed default-cursor" fxFlex="100">
                        <table mat-table [dataSource]="dataSourceDocList" multiTemplateDataRows
                            class="mat-elevation-z8 user-table">
                            <ng-container matColumnDef="{{column}}"
                                *ngFor="let column of columnsToDisplayDoc; let i=index">
                                <th mat-header-cell *matHeaderCellDef>{{columnsNameDoc[i]}} </th>
                                <td mat-cell *matCellDef="let element">
                                    <span *ngIf="i == 0 && isMobile">
                                        <mat-icon mat-raised-button
                                            [ngClass]="{'table-expand': expandIdDoc == element.document_id, 'expand-close': !(expandIdDoc == element.document_id)}">
                                            {{ expandIdDoc == element.document_id ? 'remove_circle' : 'add_circle'}}
                                        </mat-icon>
                                    </span>
                                    <div *ngIf="element?.action != 'POST PAYMENT PAPER EOR'">
                                        <span *ngIf="column == 'doc_image'" class="file_type_icon">
                                            <mat-icon *ngIf="element?.payor_response_status == 'R'" class="text-danger">
                                                error</mat-icon>
                                        </span>
                                        <span *ngIf="column == 'request_reference_id' && element?.action == 'SFTP'"
                                            class="no-wrap-td">{{element?.request_reference_id}}</span>
                                        <span *ngIf="column == 'file_name'">{{element?.file_name}}</span>
                                        <span *ngIf="column == 'action'" class="no-wrap-td"
                                            [ngSwitch]="element?.action">
                                            <span *ngSwitchCase="'BD'">Downloaded</span>
                                            <span *ngSwitchCase="'MES'">E-Sign Downloaded</span>
                                            <span *ngSwitchCase="'SFTP'"><span *ngIf="!element?.isdtm_request">Billed On
                                                    Demand</span>
                                                <span *ngIf="element?.isdtm_request">Mailed On Demand</span></span>
                                        </span>
                                        <span *ngIf="column == 'date'" class="no-wrap-td">{{element?.date_of_request |
                                            date:'MM-dd-yyyy'}}</span>
                                        <span *ngIf="column == 'recipients'"><span
                                                *ngFor="let rec of element?.recipients;let last = last;">{{rec?.name}}{{!last
                                                ? ', ' : ''}}</span></span>
                                        <span *ngIf="column == 'download' && element?.send">
                                            <a class="text-success"
                                                (click)="$event.stopPropagation();downloadDocumet(element?.send,element)">Download</a>
                                        </span>
                                        <span *ngIf="column == 'payor_response_message'">
                                            {{element?.payor_response_message?.length ?
                                            element?.payor_response_message[0]?._attributes?.MessageText :
                                            element?.payor_response_message?._attributes?.MessageText}}
                                        </span>
                                    </div>
                                    <div *ngIf="element?.action == 'POST PAYMENT PAPER EOR'">
                                        <span *ngIf="column == 'doc_image'" class="file_type_icon">
                                        </span>
                                        <span *ngIf="column == 'request_reference_id' && element?.action == 'SFTP'"
                                            class="no-wrap-td">{{element?.request_reference_id}}</span>
                                        <span *ngIf="column == 'file_name'">{{element?.file_name}}</span>
                                        <span *ngIf="column == 'action'" class="no-wrap-td">{{element?.action}}</span>
                                        <span *ngIf="column == 'date'" class="no-wrap-td">{{element?.date_of_request |
                                            date:'MM-dd-yyyy'}}</span>
                                        <span *ngIf="column == 'recipients'"></span>
                                        <span *ngIf="column == 'download'">
                                            <a class="text-success"
                                                (click)="$event.stopPropagation();downloadDocumet(element)">Download</a>
                                        </span>
                                        <span *ngIf="column == 'payor_response_message'">
                                        </span>
                                    </div>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="expandedDetail">
                                <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplayDoc.length">
                                    <div class="detail"
                                        [@detailExpand]="expandIdDoc == element.document_id ? 'expanded' : 'collapsed'">
                                        <div class="responsive-table">
                                            <section *ngIf="element?.action != 'POST PAYMENT PAPER EOR'">
                                                <div class="no-wrap-td" *ngIf="element?.action == 'SFTP'"><span>Ref
                                                        #</span><span> {{element?.request_reference_id}} </span></div>
                                                <div [ngSwitch]="element.action"><span>Action</span>
                                                    <p *ngSwitchCase="'MD'">Downloaded</p>
                                                    <p *ngSwitchCase="'MES'">E-Sign Downloaded</p>
                                                    <p *ngSwitchCase="'SFTP'"><span
                                                            *ngIf="!element?.isdtm_request">Billed On Demand</span>
                                                        <span *ngIf="element?.isdtm_request">Mailed On Demand</span>
                                                    </p>
                                                </div>
                                                <div><span>Date</span>{{element?.date_of_request | date:'MM-dd-yyyy'}}
                                                </div>
                                                <div><span>Recipients</span></div>
                                                <div><span>Download Sent Documents </span><a class="text-success"
                                                        (click)="downloadDocumet(element?.send,element)">Download</a>
                                                </div>
                                                <div><span>Further Information</span>
                                                    {{element?.payor_response_message?.length ?
                                                    element?.payor_response_message[0]?._attributes?.MessageText :
                                                    element?.payor_response_message?._attributes?.MessageText}}
                                                </div>
                                            </section>

                                            <section *ngIf="element?.action == 'POST PAYMENT PAPER EOR'">
                                                <div class="no-wrap-td" *ngIf="element?.action == 'SFTP'"><span>Ref
                                                        #</span><span> {{element?.request_reference_id}} </span></div>
                                                <div [ngSwitch]="element.action"><span>Action</span>
                                                    {{element?.action}}
                                                </div>
                                                <div><span>Date</span>{{element?.date_of_request | date:'MM-dd-yyyy'}}
                                                </div>
                                                <div><span>Recipients</span></div>
                                                <div><span>Download Sent Documents </span><a class="text-success"
                                                        (click)="$event.stopPropagation();downloadDocumet(element)">Download</a>
                                                </div>
                                                <div><span>Further Information</span></div>
                                            </section>
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="columnsToDisplayDoc;sticky :true"></tr>
                            <tr mat-row *matRowDef="let element; columns: columnsToDisplayDoc;" class="row"
                                [class.row]="expandedElement === element" (click)="openElementDoc(element)">
                            </tr>
                            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
                        </table>
                        <app-nodata *ngIf="dataSourceDocList?.filteredData?.length == 0"></app-nodata>
                    </div>
                </div>
            </mat-card-content>
        </mat-card> -->
    </div>
</div>