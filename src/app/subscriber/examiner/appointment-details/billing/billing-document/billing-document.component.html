<mat-card>
    <mat-card-content>
        <div fxLayout="row wrap" class="w-100">
            <div fxFlex="100">
                <div class="main-title p-l-0">Billing Documents</div>
                <p class="description p-l-0">This table lists the documents, actions that were performed on the
                    documents, the date
                    that the actions were performed and the document recipients.</p>
            </div>
            <div class="user-detail vertical-fixed default-cursor" fxFlex="100">
                <table mat-table [dataSource]="dataSourceDocList" multiTemplateDataRows
                    class="mat-elevation-z8 user-table">
                    <ng-container matColumnDef="{{column}}"
                        *ngFor="let column of columnsToDisplayDoc; let i=index">
                        <th mat-header-cell *matHeaderCellDef>{{columnsNameDoc[i]}} </th>
                        <td mat-cell *matCellDef="let element">
                            <span *ngIf="i == 0 && isMobile">
                                <mat-icon mat-raised-button
                                    [ngClass]="{'table-expand': expandIdDoc == element.document_id, 'expand-close': !(expandIdDoc == element.document_id)}">
                                    {{ expandIdDoc == element.document_id ? 'remove_circle' : 'add_circle'}}
                                </mat-icon>
                            </span>
                            <div *ngIf="element?.action != 'POST PAYMENT PAPER EOR'">
                                <span *ngIf="column == 'doc_image'" class="file_type_icon">
                                    <mat-icon *ngIf="element?.payor_response_status == 'R'" class="text-danger">
                                        error</mat-icon>
                                </span>
                                <span *ngIf="column == 'request_reference_id' && element?.action == 'SFTP'"
                                    class="no-wrap-td">{{element?.request_reference_id}}</span>
                                <span *ngIf="column == 'file_name'">{{element?.file_name}}</span>
                                <span *ngIf="column == 'action'" class="no-wrap-td"
                                    [ngSwitch]="element?.action">
                                    <span *ngSwitchCase="'BD'">Downloaded</span>
                                    <span *ngSwitchCase="'MES'">E-Sign Downloaded</span>
                                    <span *ngSwitchCase="'SFTP'"><span *ngIf="!element?.isdtm_request">Billed On
                                            Demand</span>
                                        <span *ngIf="element?.isdtm_request">Mailed On Demand</span></span>
                                </span>
                                <span *ngIf="column == 'date'" class="no-wrap-td">{{element?.date_of_request |
                                    date:'MM-dd-yyyy'}}</span>
                                <span *ngIf="column == 'recipients'"><span
                                        *ngFor="let rec of element?.recipients;let last = last;">{{rec?.name}}{{!last
                                        ? ', ' : ''}}</span></span>
                                <span *ngIf="column == 'download' && element?.send">
                                    <a class="text-success"
                                        (click)="$event.stopPropagation();downloadDocumet(element?.send,element)">Download</a>
                                </span>
                                <span *ngIf="column == 'payor_response_message'">
                                    {{element?.payor_response_message?.length ?
                                    element?.payor_response_message[0]?._attributes?.MessageText :
                                    element?.payor_response_message?._attributes?.MessageText}}
                                </span>
                            </div>
                            <div *ngIf="element?.action == 'POST PAYMENT PAPER EOR'">
                                <span *ngIf="column == 'doc_image'" class="file_type_icon">
                                </span>
                                <span *ngIf="column == 'request_reference_id' && element?.action == 'SFTP'"
                                    class="no-wrap-td">{{element?.request_reference_id}}</span>
                                <span *ngIf="column == 'file_name'">{{element?.file_name}}</span>
                                <span *ngIf="column == 'action'" class="no-wrap-td">{{element?.action}}</span>
                                <span *ngIf="column == 'date'" class="no-wrap-td">{{element?.date_of_request |
                                    date:'MM-dd-yyyy'}}</span>
                                <span *ngIf="column == 'recipients'"></span>
                                <span *ngIf="column == 'download'">
                                    <a class="text-success"
                                        (click)="$event.stopPropagation();downloadDocumet(element)">Download</a>
                                </span>
                                <span *ngIf="column == 'payor_response_message'">
                                </span>
                            </div>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="expandedDetail">
                        <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplayDoc.length">
                            <div class="detail"
                                [@detailExpand]="expandIdDoc == element.document_id ? 'expanded' : 'collapsed'">
                                <div class="responsive-table">
                                    <section *ngIf="element?.action != 'POST PAYMENT PAPER EOR'">
                                        <div class="no-wrap-td" *ngIf="element?.action == 'SFTP'"><span>Ref
                                                #</span><span> {{element?.request_reference_id}} </span></div>
                                        <div [ngSwitch]="element.action"><span>Action</span>
                                            <p *ngSwitchCase="'MD'">Downloaded</p>
                                            <p *ngSwitchCase="'MES'">E-Sign Downloaded</p>
                                            <p *ngSwitchCase="'SFTP'"><span
                                                    *ngIf="!element?.isdtm_request">Billed On Demand</span>
                                                <span *ngIf="element?.isdtm_request">Mailed On Demand</span>
                                            </p>
                                        </div>
                                        <div><span>Date</span>{{element?.date_of_request | date:'MM-dd-yyyy'}}
                                        </div>
                                        <div><span>Recipients</span></div>
                                        <div><span>Download Sent Documents </span><a class="text-success"
                                                (click)="downloadDocumet(element?.send,element)">Download</a>
                                        </div>
                                        <div><span>Further Information</span>
                                            {{element?.payor_response_message?.length ?
                                            element?.payor_response_message[0]?._attributes?.MessageText :
                                            element?.payor_response_message?._attributes?.MessageText}}
                                        </div>
                                    </section>

                                    <section *ngIf="element?.action == 'POST PAYMENT PAPER EOR'">
                                        <div class="no-wrap-td" *ngIf="element?.action == 'SFTP'"><span>Ref
                                                #</span><span> {{element?.request_reference_id}} </span></div>
                                        <div [ngSwitch]="element.action"><span>Action</span>
                                            {{element?.action}}
                                        </div>
                                        <div><span>Date</span>{{element?.date_of_request | date:'MM-dd-yyyy'}}
                                        </div>
                                        <div><span>Recipients</span></div>
                                        <div><span>Download Sent Documents </span><a class="text-success"
                                                (click)="$event.stopPropagation();downloadDocumet(element)">Download</a>
                                        </div>
                                        <div><span>Further Information</span></div>
                                    </section>
                                </div>
                            </div>
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="columnsToDisplayDoc;sticky :true"></tr>
                    <tr mat-row *matRowDef="let element; columns: columnsToDisplayDoc;" class="row"
                        [class.row]="expandedElement === element" (click)="openElementDoc(element)">
                    </tr>
                    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
                </table>
                <app-nodata *ngIf="dataSourceDocList?.filteredData?.length == 0"></app-nodata>
            </div>
        </div>
    </mat-card-content>
</mat-card>